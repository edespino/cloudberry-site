"use strict";(self.webpackChunkApache_Cloudberry_Incubating_website=self.webpackChunkApache_Cloudberry_Incubating_website||[]).push([[94560],{67198:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>o,contentTitle:()=>d,default:()=>h,frontMatter:()=>r,metadata:()=>c,toc:()=>l});var t=n(85893),i=n(11151);const r={title:"pg_stat_progress_create_index"},d=void 0,c={id:"sys-catalogs/sys-views/pg-stat-progress-create-index",title:"pg_stat_progress_create_index",description:"pgstatprogresscreateindex",source:"@site/versioned_docs/version-2.x/sys-catalogs/sys-views/pg-stat-progress-create-index.md",sourceDirName:"sys-catalogs/sys-views",slug:"/sys-catalogs/sys-views/pg-stat-progress-create-index",permalink:"/docs/sys-catalogs/sys-views/pg-stat-progress-create-index",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/cloudberry-site/edit/main/versioned_docs/version-2.x/sys-catalogs/sys-views/pg-stat-progress-create-index.md",tags:[],version:"2.x",lastUpdatedBy:"Dianjin Wang",lastUpdatedAt:1757492265,formattedLastUpdatedAt:"Sep 10, 2025",frontMatter:{title:"pg_stat_progress_create_index"},sidebar:"docsbars",previous:{title:"pg_stat_progress_copy",permalink:"/docs/sys-catalogs/sys-views/pg-stat-progress-copy"},next:{title:"gp_toolkit",permalink:"/docs/sys-catalogs/gp_toolkit"}},o={},l=[{value:"pg_stat_progress_create_index",id:"pg_stat_progress_create_index",level:2},{value:"Field descriptions",id:"field-descriptions",level:3}];function a(e){const s={admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.h2,{id:"pg_stat_progress_create_index",children:"pg_stat_progress_create_index"}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.code,{children:"pg_stat_progress_create_index"})," is a system view that shows real-time progress for ongoing ",(0,t.jsx)(s.code,{children:"CREATE INDEX"})," or ",(0,t.jsx)(s.code,{children:"REINDEX"})," operations in the current database."]}),"\n",(0,t.jsx)(s.p,{children:"This view displays detailed status information for each backend process building an index, including the current execution phase, the number of tuples processed, blocks scanned, and more. Once the operation completes, the corresponding entries are automatically removed from the view."}),"\n",(0,t.jsx)(s.p,{children:"In Apache Cloudberry, this view also supports AO (Append-Optimized) tables and can be used to observe the phase-wise progress of index creation on such tables."}),"\n",(0,t.jsx)(s.p,{children:"Typical use cases include:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Monitoring index creation or rebuild operations in real time."}),"\n",(0,t.jsxs)(s.li,{children:["Analyzing performance bottlenecks of long-running ",(0,t.jsx)(s.code,{children:"CREATE INDEX"})," or ",(0,t.jsx)(s.code,{children:"REINDEX"})," commands."]}),"\n",(0,t.jsx)(s.li,{children:"Checking if any index operations are currently consuming system resources."}),"\n",(0,t.jsxs)(s.li,{children:["Correlating with ",(0,t.jsx)(s.code,{children:"pg_stat_activity"})," to trace backend process details."]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"Example queries:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-sql",children:"-- Views all ongoing index creation tasks\nSELECT * FROM pg_stat_progress_create_index;\n\n-- Views index progress for a specific table\nSELECT * FROM pg_stat_progress_create_index\nWHERE relid = 'ao_test'::regclass;\n"})}),"\n",(0,t.jsx)(s.h3,{id:"field-descriptions",children:"Field descriptions"}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Field"}),(0,t.jsx)(s.th,{children:"Description"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"gp_segment_id"})}),(0,t.jsx)(s.td,{children:"ID of the segment where this entry resides. Only applicable in a distributed environment."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"pid"})}),(0,t.jsxs)(s.td,{children:["Process ID of the backend. Can be joined with ",(0,t.jsx)(s.code,{children:"pg_stat_activity"})," for session details."]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"datid"})}),(0,t.jsxs)(s.td,{children:["OID of the database, corresponding to ",(0,t.jsx)(s.code,{children:"pg_database.oid"}),"."]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"datname"})}),(0,t.jsx)(s.td,{children:"Name of the database."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"relid"})}),(0,t.jsxs)(s.td,{children:["OID of the table being indexed, corresponding to ",(0,t.jsx)(s.code,{children:"pg_class.oid"}),"."]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"index_relid"})}),(0,t.jsx)(s.td,{children:"OID of the index being built."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"command"})}),(0,t.jsxs)(s.td,{children:["Command being executed: ",(0,t.jsx)(s.code,{children:"CREATE INDEX"})," or ",(0,t.jsx)(s.code,{children:"REINDEX"}),"."]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"phase"})}),(0,t.jsxs)(s.td,{children:["Current phase of execution, for example: ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"initializing"}),": Initialization phase ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"scanning heap"}),": Scanning table data ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"sorting"}),": Sorting phase ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"building index: loading tuples in tree"}),": Building index structure ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"waiting for locks"}),": Waiting for table or metadata locks"]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"lockers_total"})}),(0,t.jsx)(s.td,{children:"Total number of sessions holding conflicting locks (if any)."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"lockers_done"})}),(0,t.jsx)(s.td,{children:"Number of sessions that have released their locks."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"current_locker_pid"})}),(0,t.jsx)(s.td,{children:"Process ID of the session currently holding the lock (if waiting)."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"blocks_total"})}),(0,t.jsx)(s.td,{children:"Total number of data blocks to scan (may be 0 if unknown or not started)."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"blocks_done"})}),(0,t.jsx)(s.td,{children:"Number of data blocks already scanned."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"tuples_total"})}),(0,t.jsx)(s.td,{children:"Estimated total number of tuples to process (if available)."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"tuples_done"})}),(0,t.jsx)(s.td,{children:"Number of tuples already processed."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"partitions_total"})}),(0,t.jsx)(s.td,{children:"Total number of partitions (if applicable)."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"partitions_done"})}),(0,t.jsx)(s.td,{children:"Number of partitions already processed (if applicable)."})]})]})]}),"\n",(0,t.jsx)(s.admonition,{type:"note",children:(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"This view only shows currently running index operations. Entries disappear once the operation completes."}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"For small tables, index creation may complete instantly, and the view might return no rows."}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"To better observe progress, try creating an index on a large table or use complex columns (for example, large text) to slow down execution."}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"Progress is also reported when building indexes on AO (Append-Optimized) tables."}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:["You can join this view with ",(0,t.jsx)(s.code,{children:"pg_stat_activity"})," using the ",(0,t.jsx)(s.code,{children:"pid"})," field."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-sql",children:"SELECT a.usename, a.query, p.phase, p.blocks_done, p.blocks_total\nFROM pg_stat_activity a\nJOIN pg_stat_progress_create_index p ON a.pid = p.pid;\n"})}),"\n"]}),"\n"]})})]})}function h(e={}){const{wrapper:s}={...(0,i.a)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},11151:(e,s,n)=>{n.d(s,{Z:()=>c,a:()=>d});var t=n(67294);const i={},r=t.createContext(i);function d(e){const s=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),t.createElement(r.Provider,{value:s},e.children)}}}]);