"use strict";(self.webpackChunkApache_Cloudberry_Incubating_website=self.webpackChunkApache_Cloudberry_Incubating_website||[]).push([[77357],{17261:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>u,frontMatter:()=>a,metadata:()=>r,toc:()=>l});var s=t(85893),o=t(11151);const a={title:"Table Functions"},i="Table Functions",r={id:"operate-with-data/sql-queries/table-functions",title:"Table Functions",description:"Table functions are functions that produce a set of rows, made up of either base data types (scalar types) or composite data types (table rows). They are used like a table, view, or subquery in the FROM clause of a query. Columns returned by table functions can be included in SELECT, JOIN, or WHERE clauses in the same manner as columns of a table, view, or subquery.",source:"@site/versioned_docs/version-2.x/operate-with-data/sql-queries/table-functions.md",sourceDirName:"operate-with-data/sql-queries",slug:"/operate-with-data/sql-queries/table-functions",permalink:"/docs/operate-with-data/sql-queries/table-functions",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/cloudberry-site/edit/main/versioned_docs/version-2.x/operate-with-data/sql-queries/table-functions.md",tags:[],version:"2.x",lastUpdatedBy:"Dianjin Wang",lastUpdatedAt:1754561742,formattedLastUpdatedAt:"Aug 7, 2025",frontMatter:{title:"Table Functions"},sidebar:"docsbars",previous:{title:"Common Table Expressions",permalink:"/docs/operate-with-data/sql-queries/cte-queries"},next:{title:"Queries with Window Functions",permalink:"/docs/operate-with-data/sql-queries/window-functions"}},c={},l=[];function d(e){const n={code:"code",h1:"h1",p:"p",pre:"pre",...(0,o.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"table-functions",children:"Table Functions"}),"\n",(0,s.jsxs)(n.p,{children:["Table functions are functions that produce a set of rows, made up of either base data types (scalar types) or composite data types (table rows). They are used like a table, view, or subquery in the ",(0,s.jsx)(n.code,{children:"FROM"})," clause of a query. Columns returned by table functions can be included in ",(0,s.jsx)(n.code,{children:"SELECT"}),", ",(0,s.jsx)(n.code,{children:"JOIN"}),", or ",(0,s.jsx)(n.code,{children:"WHERE"})," clauses in the same manner as columns of a table, view, or subquery."]}),"\n",(0,s.jsxs)(n.p,{children:["Table functions might also be combined using the ",(0,s.jsx)(n.code,{children:"ROWS FROM"})," syntax, with the results returned in parallel columns; the number of result rows in this case is that of the largest function result, with smaller results padded with null values to match."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"function_call [WITH ORDINALITY] [[AS] table_alias [(column_alias [, ... ])]]\nROWS FROM( function_call [, ... ] ) [WITH ORDINALITY] [[AS] table_alias [(column_alias [, ... ])]]\n"})}),"\n",(0,s.jsxs)(n.p,{children:["If the ",(0,s.jsx)(n.code,{children:"WITH ORDINALITY"})," clause is specified, an additional column of type bigint will be added to the function result columns. This column numbers the rows of the function result set, starting from 1. (This is a generalization of the SQL-standard syntax for ",(0,s.jsx)(n.code,{children:"UNNEST ... WITH ORDINALITY"}),".) By default, the ordinal column is called ordinality, but a different column name can be assigned to it using an ",(0,s.jsx)(n.code,{children:"AS"})," clause."]}),"\n",(0,s.jsxs)(n.p,{children:["The special table function ",(0,s.jsx)(n.code,{children:"UNNEST"})," might be called with any number of array parameters, and it returns a corresponding number of columns, as if ",(0,s.jsx)(n.code,{children:"UNNEST"})," had been called on each parameter separately and combined using the ",(0,s.jsx)(n.code,{children:"ROWS FROM"})," construct."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"UNNEST( array_expression [, ... ] ) [WITH ORDINALITY] [[AS] table_alias [(column_alias [, ... ])]]\n"})}),"\n",(0,s.jsxs)(n.p,{children:["If no table_alias is specified, the function name is used as the table name; in the case of a ",(0,s.jsx)(n.code,{children:"ROWS FROM()"})," construct, the first function's name is used."]}),"\n",(0,s.jsx)(n.p,{children:"If column aliases are not supplied, then for a function returning a base data type, the column name is also the same as the function name. For a function returning a composite type, the result columns get the names of the individual attributes of the type."}),"\n",(0,s.jsx)(n.p,{children:"Some examples:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE foo (fooid int, foosubid int, fooname text);\n\nCREATE FUNCTION getfoo(int) RETURNS SETOF foo AS $$\n    SELECT * FROM foo WHERE fooid = $1;\n$$ LANGUAGE SQL;\n\nSELECT * FROM getfoo(1) AS t1;\n\nSELECT * FROM foo\n    WHERE foosubid IN (\n                        SELECT foosubid\n                        FROM getfoo(foo.fooid) z\n                        WHERE z.fooid = foo.fooid\n                      );\n\nCREATE VIEW vw_getfoo AS SELECT * FROM getfoo(1);\n\nSELECT * FROM vw_getfoo;\n"})}),"\n",(0,s.jsxs)(n.p,{children:["In some cases it is useful to define table functions that can return different column sets depending on how they are invoked. To support this, the table function can be declared as returning the pseudo-type record with no ",(0,s.jsx)(n.code,{children:"OUT"})," parameters. When such a function is used in a query, the expected row structure must be specified in the query itself, so that the system can know how to parse and plan the query. This syntax looks like:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"function_call [AS] alias (column_definition [, ... ])\nfunction_call AS [alias] (column_definition [, ... ])\nROWS FROM( ... function_call AS (column_definition [, ... ]) [, ... ] )\n"})}),"\n",(0,s.jsxs)(n.p,{children:["When not using the ",(0,s.jsx)(n.code,{children:"ROWS FROM()"})," syntax, the ",(0,s.jsx)(n.code,{children:"column_definition"})," list replaces the column alias list that can otherwise be attached to the FROM item; the names in the column definitions serve as column aliases. When using the ",(0,s.jsx)(n.code,{children:"ROWS FROM()"})," syntax, a ",(0,s.jsx)(n.code,{children:"column_definition"})," list can be attached to each member function separately; or if there is only one member function and no ",(0,s.jsx)(n.code,{children:"WITH ORDINALITY"})," clause, a ",(0,s.jsx)(n.code,{children:"column_definition"})," list can be written in place of a column alias list following ",(0,s.jsx)(n.code,{children:"ROWS FROM()"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"Consider this example:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"SELECT *\n    FROM dblink('dbname=mydb', 'SELECT proname, prosrc FROM pg_proc')\n      AS t1(proname name, prosrc text)\n    WHERE proname LIKE 'bytea%';\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"dblink"})," function (part of the ",(0,s.jsx)(n.code,{children:"dblink"})," module) executes a remote query. It is declared to return record because it might be used for any kind of query. The actual column set must be specified in the calling query so that the parser knows, for example, what ",(0,s.jsx)(n.code,{children:"*"})," should expand to."]}),"\n",(0,s.jsxs)(n.p,{children:["This example uses ",(0,s.jsx)(n.code,{children:"ROWS FROM"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:'SELECT *\nFROM ROWS FROM\n    (\n        json_to_recordset(\'[{"a":40,"b":"foo"},{"a":"100","b":"bar"}]\')\n            AS (a INTEGER, b TEXT),\n        generate_series(1, 3)\n    ) AS x (p, q, s)\nORDER BY p;\n\n  p  |  q  | s\n-----+-----+---\n  40 | foo | 1\n 100 | bar | 2\n     |     | 3\n'})}),"\n",(0,s.jsxs)(n.p,{children:["It joins two functions into a single ",(0,s.jsx)(n.code,{children:"FROM"})," target. ",(0,s.jsx)(n.code,{children:"json_to_recordset()"})," is instructed to return two columns, the first integer and the second text. The result of ",(0,s.jsx)(n.code,{children:"generate_series()"})," is used directly. The ",(0,s.jsx)(n.code,{children:"ORDER BY"})," clause sorts the column values as integers."]})]})}function u(e={}){const{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},11151:(e,n,t)=>{t.d(n,{Z:()=>r,a:()=>i});var s=t(67294);const o={},a=s.createContext(o);function i(e){const n=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);