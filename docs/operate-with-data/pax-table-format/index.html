<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-2.x docs-doc-page docs-doc-id-operate-with-data/pax-table-format" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">PAX Storage Format | Apache Cloudberry (Incubating)</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://cloudberry.apache.org/docs/operate-with-data/pax-table-format"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="2.x"><meta data-rh="true" name="docusaurus_tag" content="docs-default-2.x"><meta data-rh="true" name="docsearch:version" content="2.x"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-2.x"><meta data-rh="true" property="og:title" content="PAX Storage Format | Apache Cloudberry (Incubating)"><meta data-rh="true" name="description" content="Apache Cloudberry supports the PAX (Partition Attributes Across) storage format."><meta data-rh="true" property="og:description" content="Apache Cloudberry supports the PAX (Partition Attributes Across) storage format."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://cloudberry.apache.org/docs/operate-with-data/pax-table-format"><link data-rh="true" rel="alternate" href="https://cloudberry.apache.org/docs/operate-with-data/pax-table-format" hreflang="en"><link data-rh="true" rel="alternate" href="https://cloudberry.apache.org/docs/operate-with-data/pax-table-format" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache Cloudberry (Incubating) is one advanced and mature open-source MPP (Massively Parallel Processing) databases available. RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache Cloudberry (Incubating) is one advanced and mature open-source MPP (Massively Parallel Processing) databases available. Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title="Apache Cloudberry (Incubating) is one advanced and mature open-source MPP (Massively Parallel Processing) databases available. JSON Feed">




<link rel="preconnect" href="https://analytics.apache.org/">
<script>var _paq=window._paq=window._paq||[];_paq.push(["setRequestMethod","POST"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),_paq.push(["enableHeartBeatTimer"]),function(){var e="https://analytics.apache.org/";_paq.push(["setRequestMethod","POST"]),_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","66"]);var a=document,t=a.createElement("script"),p=a.getElementsByTagName("script")[0];t.type="text/javascript",t.async=!0,t.src=e+"matomo.js",p.parentNode.insertBefore(t,p)}()</script><link rel="stylesheet" href="/assets/css/styles.6426df7d.css">
<script src="/assets/js/runtime~main.7f8ec95b.js" defer="defer"></script>
<script src="/assets/js/main.5fdce065.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?t("light"):t("dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="tipsWrap_WWTe"><div class="tipsContent_sMsy"><div class="text_VINd"><a href="https://github.com/apache/cloudberry" target="_blank" rel="noopener noreferrer"><span>If you like Apache Cloudberry (Incubating), give it a star on GitHub! </span><img src="/img/home/hcard/star.svg" alt=""></a></div><div class="close_vVex"><img src="/img/home/hcard/close.svg" alt=""></div></div></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div class="nav-left-logo"><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/apache_cloudberry_color_black.svg" alt="Apache Cloudberry (Incubating)" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/apache_cloudberry_color_white.svg" alt="Apache Cloudberry (Incubating)" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Docs</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next">Next</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/">2.x (Current)</a></li><li><a class="dropdown__link" href="/docs/1.x">1.x</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Community</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/community">Overview</a></li><li><a class="dropdown__link" href="/community/slack">Slack Guide</a></li><li><a class="dropdown__link" href="/community/wechat">WeChat Guide</a></li><li><a class="dropdown__link" href="/community/events">Community Events</a></li><li><a class="dropdown__link" href="/community/mailing-lists">Mailing Lists</a></li><li><a class="dropdown__link" href="/community/brand">Brand Guidelines</a></li><li><a class="dropdown__link" href="/community/security">Security Policy</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Contribute</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/contribute">Overview</a></li><li><a class="dropdown__link" href="/contribute/how-to-contribute">How to Contribute</a></li><li><a class="dropdown__link" href="/contribute/git">Working with Git &amp; GitHub</a></li><li><a class="dropdown__link" href="/contribute/code">Code Contribution Guide</a></li><li><a class="dropdown__link" href="/contribute/proposal">Proposal Guide</a></li><li><a class="dropdown__link" href="/contribute/doc">Doc Contribution Guide</a></li></ul></div><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/releases">Download</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Team</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/team">Who we are</a></li><li><a class="dropdown__link" href="/team/new-committers">Inviting New Committers</a></li><li><a class="dropdown__link" href="/team/sign-icla">Sign ICLA</a></li><li><a class="dropdown__link" href="/team/setup-apache-email-account">Setup the Apache account</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Resources</a><ul class="dropdown__menu"><li><a href="https://github.com/apache/cloudberry/wiki" target="_blank" rel="noopener noreferrer" class="dropdown__link">Wiki</a></li><li><a href="https://github.com/apache/cloudberry/discussions/868" target="_blank" rel="noopener noreferrer" class="dropdown__link">Roadmap</a></li><li><a href="https://github.com/apache/cloudberry/discussions" target="_blank" rel="noopener noreferrer" class="dropdown__link">Forum</a></li><li><a class="dropdown__link" href="/support">Support</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">ASF</a><ul class="dropdown__menu"><li><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Foundation</a></li><li><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="dropdown__link">License</a></li><li><a href="https://www.apache.org/events/current-event.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Events</a></li><li><a href="https://privacy.apache.org/policies/privacy-policy-public.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Privacy</a></li><li><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Security</a></li><li><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Sponsorship</a></li><li><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Thanks</a></li><li><a href="https://www.apache.org/foundation/policies/conduct" target="_blank" rel="noopener noreferrer" class="dropdown__link">Code of Conduct</a></li></ul></div><div class="toggle_vylO colorModeToggle_x44X check-theme-switch"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_dCNk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_BF9v"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_Rg9N"><aside class="theme-doc-sidebar-container docSidebarContainer_RSuS"><div class="sidebarViewport_pYEE"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/">Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/deployment/">Deploy and Build</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/data-loading/">Load Data</a><button aria-label="Expand sidebar category &#x27;Load Data&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/operate-with-data/operate-with-db-objects/create-and-manage-database">Create and Prepare</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/operate-with-data/operate-with-db-objects/create-and-manage-tablespaces">Operate with Data</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/operate-with-data/operate-with-db-objects/create-and-manage-tablespaces">Operate with Database Objects</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/operate-with-data/sql-queries/">SQL Queries</a><button aria-label="Expand sidebar category &#x27;SQL Queries&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/advanced-analytics/postgis">Advanced Analytics</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/operate-with-data/heap-and-ao-table-formats">Heap and AO Table Formats</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/operate-with-data/pax-table-format">PAX Storage Format</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/operate-with-data/work-with-transactions">Work with Transactions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/operate-with-data/transactional-concurrency-control">Concurrency Control for Transactions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/operate-with-data/manage-spill-files">Manage Spill Files Generated by Queries</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/performance/define-database-performance">Optimize Performance</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/security/">Security and Permission</a><button aria-label="Expand sidebar category &#x27;Security and Permission&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/sys-admin/backup-and-restore/">Manage System</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/developer/develop-extensions-using-rust">Developer</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/ecosystem/sql-clients/dbeaver">Ecosystem</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/sql-stmts/">References</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/tutorials/crash-course">Tutorials</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_hjYf"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_z5aJ"><div class="docItemContainer_c0TR"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Alpn" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_xK9p"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link" id="支付">Operate with Data</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">PAX Storage Format</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: 2.x</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_bxCs"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>PAX Storage Format</h1>
<p>Apache Cloudberry supports the PAX (Partition Attributes Across) storage format.</p>
<p>PAX is a database storage format that combines the benefits of row-based storage (NSM, N-ary Storage Model) and column-based storage (DSM, Decomposition Storage Model). It is designed to improve query performance, particularly in terms of cache efficiency. In OLAP scenarios, PAX offers batch write performance similar to row-based storage and read performance like column-based storage. PAX can adapt to both cloud environments with object storage models and traditional offline physical file-based storage methods.</p>
<p>Compared to traditional storage formats, PAX has the following features:</p>
<ul>
<li>Data updates and deletions: PAX uses a mark-and-delete approach for data updates and deletions. This effectively manages changes in physical files without immediately rewriting the entire data file.</li>
<li>Concurrency control and read-write isolation: PAX uses Multi-Version Concurrency Control (MVCC) to achieve efficient concurrency control and read-write isolation. The control granularity reaches the level of individual data files, enhancing operation safety and efficiency.</li>
<li>Index support: PAX supports B-tree indexes, which help speed up query operations. This is particularly useful for improving data retrieval speed when dealing with large amounts of data.</li>
<li>Data encoding and compression: PAX offers multiple data encoding methods (such as run-length encoding and delta encoding) and compression options (such as zstd and zlib), with various compression levels. These features help reduce storage space requirements while optimizing read performance.</li>
<li>Statistics: Data files contain detailed statistics that are used for quick filtering and query optimization, reducing unnecessary data scanning and speeding up query processing.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="applicable-scenarios">Applicable scenarios<a href="#applicable-scenarios" class="hash-link" aria-label="Direct link to Applicable scenarios" title="Direct link to Applicable scenarios">​</a></h2>
<p>The hybrid storage capability of PAX makes it suitable for complex OLAP applications that need to handle large amounts of data writes and frequent queries. Whether you are looking for a high-performance data analysis solution in a cloud infrastructure or dealing with large datasets in a traditional data center environment, PAX can provide strong support.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="enable-pax-when-building-cloudberry-from-source-code">Enable PAX when building Cloudberry from source code<a href="#enable-pax-when-building-cloudberry-from-source-code" class="hash-link" aria-label="Direct link to Enable PAX when building Cloudberry from source code" title="Direct link to Enable PAX when building Cloudberry from source code">​</a></h2>
<p>To enable PAX when building Apache Cloudberry from source code, you need to:</p>
<ol>
<li>
<p>Make sure that these dependency requirements are met:</p>
<ul>
<li>C/C++ Compiler: GCC/GCC-C++ 11 or later</li>
<li>CMake: 3.11 or later</li>
<li>Protobuf: 3.5.0 or later</li>
<li>ZSTD (libzstd): 1.4.0 or later</li>
</ul>
</li>
<li>
<p>Run the following command at the top level of the Cloudberry source code directory to download the submodules:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">git submodule update --init --recursive</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The following submodules will be downloaded for building and tesing PAX:</p>
<ul>
<li>yyjson (<code>dependency/yyjson</code>)</li>
<li>cpp-stub (<code>contrib/pax_storage/src/cpp/contrib</code>)</li>
<li>googlebench (<code>contrib/pax_storage/src/cpp/contrib</code>) (Now it&#x27;s an optional dependency, it will be downloaded but not built by default. If needed, you can build it manually.)</li>
<li>googletest (<code>contrib/pax_storage/src/cpp/contrib</code>)</li>
<li>tabulate (<code>contrib/pax_storage/src/cpp/contrib</code>)</li>
</ul>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>The submodules above are already included in the latest release source code archive, so you do not need to download the submodules manually after extracting the archive.</p></div></div>
</li>
<li>
<p>When running the <code>configure</code> command, add the <code>--enable-pax</code> option. For example:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">./configure --enable-pax --with-perl --with-python --with-libxml --with-gssapi --prefix=/usr/local/cloudberrydb</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In addition, to enable PAX in <code>DEBUG</code> mode, add the <code>--enable-cassert</code> option (along with <code>--enable-pax</code>) in the <code>configure</code> command, and the <code>GTEST</code> in PAX will be built. Run <code>GTEST</code> as follows:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">cd contrib/pax_storage/build</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">./src/cpp/test_main</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ol>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>If you are interested in the implementation details of PAX, you can refer to the <a href="https://github.com/apache/cloudberry/tree/main/contrib/pax_storage/doc" target="_blank" rel="noopener noreferrer">design documents in GitHub repo</a>.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="usage">Usage<a href="#usage" class="hash-link" aria-label="Direct link to Usage" title="Direct link to Usage">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-a-pax-table">Create a PAX table<a href="#create-a-pax-table" class="hash-link" aria-label="Direct link to Create a PAX table" title="Direct link to Create a PAX table">​</a></h3>
<p>To create a table in PAX format, you need to set the table access method to PAX. You can do this in one of the following ways:</p>
<ul>
<li>
<p>Use the <code>USING PAX</code> clause explicitly when creating the table, for example:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">TABLE</span><span class="token plain"> t1</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">a </span><span class="token keyword" style="color:#66d9ef">int</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> b </span><span class="token keyword" style="color:#66d9ef">int</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> c </span><span class="token keyword" style="color:#66d9ef">text</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">USING</span><span class="token plain"> PAX</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic">-- t1 is a PAX table and can be used like a normal heap table.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Set the default table access method to PAX and then create the table:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#8292a2;font-style:italic">-- Set the default table access method. From now on, newly created tables will use PAX format.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">SET</span><span class="token plain"> default_table_access_method </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> pax</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic">-- Implicitly use the default access method, which is PAX.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">TABLE</span><span class="token plain"> t1</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">a </span><span class="token keyword" style="color:#66d9ef">int</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> b </span><span class="token keyword" style="color:#66d9ef">int</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> c </span><span class="token keyword" style="color:#66d9ef">text</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
<p>When creating a table, you can also specify minimum and maximum value information for certain columns to speed up queries:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#8292a2;font-style:italic">-- Use WITH(minmax_columns=&#x27;b,c&#x27;) to specify that columns b and c</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic">-- should record min and max statistics.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic">-- This helps optimize queries involving these two columns,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic">-- because the system can quickly determine which data blocks might contain matching data.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">TABLE</span><span class="token plain"> p2</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">a </span><span class="token keyword" style="color:#66d9ef">INT</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> b </span><span class="token keyword" style="color:#66d9ef">INT</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> c </span><span class="token keyword" style="color:#66d9ef">INT</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">USING</span><span class="token plain"> pax </span><span class="token keyword" style="color:#66d9ef">WITH</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">minmax_columns</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&#x27;b,c&#x27;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">INTO</span><span class="token plain"> p2 </span><span class="token keyword" style="color:#66d9ef">SELECT</span><span class="token plain"> i</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> i </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">2</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> i </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">3</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">FROM</span><span class="token plain"> generate_series</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token number" style="color:#ae81ff">1</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token number" style="color:#ae81ff">10</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain">i</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic">-- because column b has minmax statistics,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic">-- the system can quickly locate the data blocks that might contain the value, speeding up the query.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">FROM</span><span class="token plain"> p2 </span><span class="token keyword" style="color:#66d9ef">WHERE</span><span class="token plain"> b </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">4</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic">-- Similarly, because of the minmax information on column b, the system can quickly determine that no data blocks can meet this condition</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic">-- (if all generated values are positive), possibly returning no data immediately and avoiding unnecessary data scans.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">FROM</span><span class="token plain"> p2 </span><span class="token keyword" style="color:#66d9ef">WHERE</span><span class="token plain"> b </span><span class="token operator" style="color:#66d9ef">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic">-- Modify the minmax statistics settings for table p2 to apply only to column b. For data inserted later,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic">-- only column b will maintain this statistical information, and it won&#x27;t affect existing data or trigger any rewrites or adjustments.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">TABLE</span><span class="token plain"> p2 </span><span class="token keyword" style="color:#66d9ef">SET</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">minmax_columns</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&#x27;b&#x27;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="view-the-format-of-an-existing-table">View the format of an existing table<a href="#view-the-format-of-an-existing-table" class="hash-link" aria-label="Direct link to View the format of an existing table" title="Direct link to View the format of an existing table">​</a></h3>
<p>To check whether a table is in PAX format, you can use one of the following methods:</p>
<ul>
<li>
<p>Use the <code>psql</code> command <code>\d+</code>:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">gpadmin</span><span class="token operator" style="color:#66d9ef">=</span><span class="token comment" style="color:#8292a2;font-style:italic"># \d+ t1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                                            </span><span class="token keyword" style="color:#66d9ef">Table</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;public.t1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">Column</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain">  </span><span class="token keyword" style="color:#66d9ef">Type</span><span class="token plain">   </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> Collation </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> Nullable </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">Default</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> Storage  </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> Compression </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> Stats target </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> Description</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic">--------+---------+-----------+----------+---------+----------+-------------+--------------+-------------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">a      </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">integer</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain">           </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain">          </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain">         </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> plain    </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain">             </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain">              </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">b      </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">integer</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain">           </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain">          </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain">         </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> plain    </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain">             </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain">              </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">c      </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">text</span><span class="token plain">    </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain">           </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain">          </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain">         </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">extended</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain">             </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain">              </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">Distributed</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">by</span><span class="token plain">: </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">a</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Access method: pax</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Query the system catalog tables <code>pg_class</code> and <code>pg_am</code>:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">SELECT</span><span class="token plain"> relname</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> amname </span><span class="token keyword" style="color:#66d9ef">FROM</span><span class="token plain"> pg_class</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> pg_am </span><span class="token keyword" style="color:#66d9ef">WHERE</span><span class="token plain"> relam </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> pg_am</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">oid </span><span class="token operator" style="color:#66d9ef">AND</span><span class="token plain"> relname </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;t1&#x27;</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">relname </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> amname</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic">---------+--------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">t1      </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> pax</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token number" style="color:#ae81ff">1</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">row</span><span class="token punctuation" style="color:#f8f8f2">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="support-for-toast">Support for TOAST<a href="#support-for-toast" class="hash-link" aria-label="Direct link to Support for TOAST" title="Direct link to Support for TOAST">​</a></h2>
<p>If some columns in a PAX table contain large values, you can enable TOAST storage to store these large values in a separate TOAST file. This helps to make the data in the main data file more compact, allowing you to scan more tuples within the same data size.</p>
<p>By default, the TOAST storage is enabled for PAX tables. Unlike PostgreSQL, the TOAST storage supported by PAX does not rely on Page management, which allows PAX to store data larger than 2 MiB.</p>
<p>You can configure TOAST-related thresholds using the following parameters. For more details, refer to <a href="#pax-related-system-parameters">PAX-related system parameters</a>.</p>
<ul>
<li><code>pax_enable_toast</code></li>
<li><code>pax_min_size_of_compress_toast</code></li>
<li><code>pax_min_size_of_external_toast</code></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="support-for-clustering">Support for clustering<a href="#support-for-clustering" class="hash-link" aria-label="Direct link to Support for clustering" title="Direct link to Support for clustering">​</a></h2>
<p>Apache Cloudberry supports z-ordering for PAX tables, which greatly improves performance when managing and querying multi-dimensional data. Using the clustering feature, you can organize data in PAX tables using two different sorting strategies: index-based clustering and <code>reloptions</code>-based clustering. Note that the two strategies are mutually exclusive, and you can only choose one.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="clustering-strategies">Clustering strategies<a href="#clustering-strategies" class="hash-link" aria-label="Direct link to Clustering strategies" title="Direct link to Clustering strategies">​</a></h3>
<p>You can use the clustering feature of Apache Cloudberry to physically sort and optimize table data. The goal is to improve query performance by reorganizing the physical storage order of the data. In PAX tables, the clustering feature provides two different strategies for sorting data:</p>
<ul>
<li>
<p>Index-based clustering. This strategy is based on B-tree indexes and works similarly to the native clustering method in PostgreSQL. It is suitable when an index has already been created for the table.</p>
<p>Example:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">TABLE</span><span class="token plain"> t2</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c1 </span><span class="token keyword" style="color:#66d9ef">int</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> c2 </span><span class="token keyword" style="color:#66d9ef">int</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">USING</span><span class="token plain"> PAX</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">INDEX</span><span class="token plain"> c1_idx </span><span class="token keyword" style="color:#66d9ef">ON</span><span class="token plain"> t2</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c1</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">CLUSTER t2 </span><span class="token keyword" style="color:#66d9ef">USING</span><span class="token plain"> c1_idx</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">DROP</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">TABLE</span><span class="token plain"> t2</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p><code>reloptions</code>-based clustering. PAX tables support clustering operations based on <code>reloptions</code> where <code>cluster_columns</code> are specified, and it provides the following sorting methods:</p>
<ul>
<li>
<p>Z-order clustering: This method encodes the values of multiple columns into a byte array and sorts by this byte array. It is ideal for cases where multiple columns are used as query conditions (with no fixed order for the columns in the query). This method greatly enhances performance for multi-dimensional data queries. However, it is not suitable for string columns with the same prefix. When <code>cluster_type</code> is not specified, PAX uses z-order sorting as the default clustering strategy:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">TABLE</span><span class="token plain"> t2</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c1 </span><span class="token keyword" style="color:#66d9ef">int</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> c2 </span><span class="token keyword" style="color:#66d9ef">float</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> c3 </span><span class="token keyword" style="color:#66d9ef">text</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">USING</span><span class="token plain"> PAX </span><span class="token keyword" style="color:#66d9ef">WITH</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">cluster_columns</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&#x27;c1,c2&#x27;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">INTO</span><span class="token plain"> t2 </span><span class="token keyword" style="color:#66d9ef">SELECT</span><span class="token plain"> i</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> i</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> i::</span><span class="token keyword" style="color:#66d9ef">text</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">FROM</span><span class="token plain"> generate_series</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token number" style="color:#ae81ff">1</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">100000</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> i</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">CLUSTER t2</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">DROP</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">TABLE</span><span class="token plain"> t2</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In this example, the data in table <code>t2</code> is sorted using z-order by the <code>c1</code> and <code>c2</code> columns. This sorting method provides great performance improvement in multi-dimensional query scenarios.</p>
</li>
<li>
<p>Lexical clustering: This method sorts by the values and order of the columns, and it is primarily used for sorting and optimizing queries on string columns with the same prefix. For example:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">TABLE</span><span class="token plain"> t2</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c1 </span><span class="token keyword" style="color:#66d9ef">int</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> c2 </span><span class="token keyword" style="color:#66d9ef">float</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> c3 </span><span class="token keyword" style="color:#66d9ef">text</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">USING</span><span class="token plain"> PAX </span><span class="token keyword" style="color:#66d9ef">WITH</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">cluster_columns</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&#x27;c1,c2&#x27;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> cluster_type</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&#x27;lexical&#x27;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">INTO</span><span class="token plain"> t2 </span><span class="token keyword" style="color:#66d9ef">SELECT</span><span class="token plain"> i</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> i</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> i::</span><span class="token keyword" style="color:#66d9ef">text</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">FROM</span><span class="token plain"> generate_series</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token number" style="color:#ae81ff">1</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">100000</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> i</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">CLUSTER t2</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">DROP</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">TABLE</span><span class="token plain"> t2</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In this example, the data in table <code>t2</code> is sorted lexically by the <code>c1</code> and <code>c2</code> columns. This sorting method is well-suited for columns with the same prefix.</p>
</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="conflicts-between-clustering-types">Conflicts between clustering types<a href="#conflicts-between-clustering-types" class="hash-link" aria-label="Direct link to Conflicts between clustering types" title="Direct link to Conflicts between clustering types">​</a></h3>
<p>Note that index-based clustering and <code>cluster_columns</code>-based clustering cannot be used at the same time. If a table has already been clustered based on an index (or <code>cluster_columns</code>), you cannot specify <code>cluster_columns</code> (or an index) for clustering.</p>
<p>An example of handling cluster conflicts:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#8292a2;font-style:italic">-- Creates a table and uses index-based clustering</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">TABLE</span><span class="token plain"> t2</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c1 </span><span class="token keyword" style="color:#66d9ef">int</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> c2 </span><span class="token keyword" style="color:#66d9ef">float</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> c3 </span><span class="token keyword" style="color:#66d9ef">text</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">USING</span><span class="token plain"> PAX</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">INDEX</span><span class="token plain"> t2_idx </span><span class="token keyword" style="color:#66d9ef">ON</span><span class="token plain"> t2</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c1</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">CLUSTER t2 </span><span class="token keyword" style="color:#66d9ef">USING</span><span class="token plain"> t2_idx</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic">-- Tries to use cluster columns (will fail)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">TABLE</span><span class="token plain"> t2 </span><span class="token keyword" style="color:#66d9ef">SET</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">cluster_columns</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&#x27;c1,c2&#x27;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> cluster_type</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&#x27;zorder&#x27;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic">-- Tries to use lexical clustering (will fail)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">TABLE</span><span class="token plain"> t2 </span><span class="token keyword" style="color:#66d9ef">SET</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">cluster_columns</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&#x27;c1,c2&#x27;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> cluster_type</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&#x27;lexical&#x27;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic">-- Drops the index and successfully use lexical clustering</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">DROP</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">INDEX</span><span class="token plain"> t2_idx</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">TABLE</span><span class="token plain"> t2 </span><span class="token keyword" style="color:#66d9ef">SET</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">cluster_columns</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&#x27;c1,c2&#x27;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> cluster_type</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&#x27;lexical&#x27;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In the above example, after table <code>t2</code> is clustered using an index, attempts to set z-order or lexical clustering using <code>cluster_columns</code> will fail, until the index is dropped.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="bloom-filter-support">Bloom filter support<a href="#bloom-filter-support" class="hash-link" aria-label="Direct link to Bloom filter support" title="Direct link to Bloom filter support">​</a></h2>
<p>Apache Cloudberry supports bloom filters, allowing you to generate and maintain bloom filter information at the column level. This feature helps quickly filter data blocks and improves query performance, especially when using <code>IN</code> conditions with multiple values, greatly reducing unnecessary data scans.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="bloom-filter-options">Bloom filter options<a href="#bloom-filter-options" class="hash-link" aria-label="Direct link to Bloom filter options" title="Direct link to Bloom filter options">​</a></h3>
<p>You can specify the columns for which you want to record bloom filter information by setting the <code>bloomfilter_columns</code> option. For example:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">TABLE</span><span class="token plain"> p1 </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    a </span><span class="token keyword" style="color:#66d9ef">int</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    b </span><span class="token keyword" style="color:#66d9ef">int</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    c </span><span class="token keyword" style="color:#66d9ef">text</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">USING</span><span class="token plain"> PAX </span><span class="token keyword" style="color:#66d9ef">WITH</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">bloomfilter_columns</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&#x27;b,c,a&#x27;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In this example, bloom filters will be generated for columns <code>b</code>, <code>c</code>, and <code>a</code> in the table <code>p1</code>.</p>
<p>The size of the bloom filter is controlled by the following GUC (global user configuration) parameters:</p>
<ul>
<li><code>pax_max_tuples_per_file</code>: Controls the maximum number of tuples stored in each data file.</li>
<li><code>pax_bloom_filter_work_memory_bytes</code>: Controls the maximum memory allowed for the bloom filter.</li>
</ul>
<p>For example:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#8292a2;font-style:italic">-- Sets the maximum number of tuples per file.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">SET</span><span class="token plain"> pax_max_tuples_per_file </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">131073</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic">-- Sets the maximum bloom filter memory.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">SET</span><span class="token plain"> pax_bloom_filter_work_memory_bytes </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">1048576</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain">  </span><span class="token comment" style="color:#8292a2;font-style:italic">-- 1MB</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic">-- Creates a table and specifies bloom filter options for columns.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">TABLE</span><span class="token plain"> p1 </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    a </span><span class="token keyword" style="color:#66d9ef">int</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    b </span><span class="token keyword" style="color:#66d9ef">int</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    c </span><span class="token keyword" style="color:#66d9ef">text</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">USING</span><span class="token plain"> PAX </span><span class="token keyword" style="color:#66d9ef">WITH</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">bloomfilter_columns</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&#x27;b,c,a&#x27;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The size of the generated bloom filter is calculated as follows:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">ceil</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token function" style="color:#e6db74">min</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">pax_max_tuples_per_file </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">2</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> pax_bloom_filter_work_memory_bytes</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>ceil</code> is a rounding function, which ensures that the size of the bloom filter is always a power of <code>2</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="sparse-filtering">Sparse filtering<a href="#sparse-filtering" class="hash-link" aria-label="Direct link to Sparse filtering" title="Direct link to Sparse filtering">​</a></h2>
<p>Sparse filtering is a data scanning optimization provided by the PAX storage format. It improves query performance by skipping file scans that do not meet conditions and reducing the amount of data block to be scanned within files.</p>
<p>To use sparse filtering, make sure that the following conditions are
met:</p>
<ul>
<li>The system parameter <code>pax_enable_sparse_filter</code> is set to <code>ON</code> (default value).</li>
<li>Statistics have been configured for the relevant columns (<code>min</code>/<code>max</code> or bloom filter).</li>
<li>The query contains filter conditions (<code>WHERE</code> clause) for these columns</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="expression-support-examples">Expression support examples<a href="#expression-support-examples" class="hash-link" aria-label="Direct link to Expression support examples" title="Direct link to Expression support examples">​</a></h3>
<p>PAX supports basic conditional expressions. For example:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#8292a2;font-style:italic">-- Creates test table</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">TABLE</span><span class="token plain"> a</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">v1 </span><span class="token keyword" style="color:#66d9ef">int</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> v2 </span><span class="token keyword" style="color:#66d9ef">int</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> v3 </span><span class="token keyword" style="color:#66d9ef">int</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">USING</span><span class="token plain"> PAX </span><span class="token keyword" style="color:#66d9ef">WITH</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">minmax_columns</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&#x27;v1, v2, v3&#x27;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic">-- Basic conditions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">FROM</span><span class="token plain"> a </span><span class="token keyword" style="color:#66d9ef">WHERE</span><span class="token plain"> v1 </span><span class="token operator" style="color:#66d9ef">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">3</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain">                                    </span><span class="token comment" style="color:#8292a2;font-style:italic">-- Full condition support. root is OpExpr.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">FROM</span><span class="token plain"> a </span><span class="token keyword" style="color:#66d9ef">WHERE</span><span class="token plain"> v1 </span><span class="token operator" style="color:#66d9ef">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">NULL</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain">                                </span><span class="token comment" style="color:#8292a2;font-style:italic">-- Full condition support. root is NULLTest.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic">-- Multiple conditions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">FROM</span><span class="token plain"> a </span><span class="token keyword" style="color:#66d9ef">WHERE</span><span class="token plain"> v1 </span><span class="token operator" style="color:#66d9ef">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">3</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">AND</span><span class="token plain"> v2 </span><span class="token operator" style="color:#66d9ef">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">3</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain">                       </span><span class="token comment" style="color:#8292a2;font-style:italic">-- Full condition support. Tree structure has only one level.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">FROM</span><span class="token plain"> a </span><span class="token keyword" style="color:#66d9ef">WHERE</span><span class="token plain"> v1 </span><span class="token operator" style="color:#66d9ef">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">3</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">AND</span><span class="token plain"> v2 </span><span class="token operator" style="color:#66d9ef">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">3</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">AND</span><span class="token plain"> v3 </span><span class="token operator" style="color:#66d9ef">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">3</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain">          </span><span class="token comment" style="color:#8292a2;font-style:italic">-- Full condition support.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">FROM</span><span class="token plain"> a </span><span class="token keyword" style="color:#66d9ef">WHERE</span><span class="token plain"> v1 </span><span class="token operator" style="color:#66d9ef">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">3</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">AND</span><span class="token plain"> v2 </span><span class="token operator" style="color:#66d9ef">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">3</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">AND</span><span class="token plain"> v3 </span><span class="token operator" style="color:#66d9ef">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">NULL</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain">       </span><span class="token comment" style="color:#8292a2;font-style:italic">-- Full condition support.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>PAX also supports nested expression structures and certain operators. For example:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#8292a2;font-style:italic">-- Creates test table.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">TABLE</span><span class="token plain"> a</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">v1 </span><span class="token keyword" style="color:#66d9ef">int</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> v2 </span><span class="token keyword" style="color:#66d9ef">int</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> v3 </span><span class="token keyword" style="color:#66d9ef">int</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">USING</span><span class="token plain"> PAX </span><span class="token keyword" style="color:#66d9ef">WITH</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">minmax_columns</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&#x27;v1, v2, v3&#x27;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic">-- Nested expressions.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">FROM</span><span class="token plain"> a </span><span class="token keyword" style="color:#66d9ef">WHERE</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">v1 </span><span class="token operator" style="color:#66d9ef">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">3</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">OR</span><span class="token plain"> v2 </span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">3</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">AND</span><span class="token plain"> v3 </span><span class="token operator" style="color:#66d9ef">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">10</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain">         </span><span class="token comment" style="color:#8292a2;font-style:italic">-- Full support for all conditions.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">FROM</span><span class="token plain"> a </span><span class="token keyword" style="color:#66d9ef">WHERE</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">v1 </span><span class="token operator" style="color:#66d9ef">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">3</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">AND</span><span class="token plain"> v2 </span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">3</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">OR</span><span class="token plain"> v3 </span><span class="token operator" style="color:#66d9ef">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">10</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain">         </span><span class="token comment" style="color:#8292a2;font-style:italic">-- Supports complete nested expressions.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic">-- Operators.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">FROM</span><span class="token plain"> a </span><span class="token keyword" style="color:#66d9ef">WHERE</span><span class="token plain"> v1 </span><span class="token operator" style="color:#66d9ef">+</span><span class="token plain"> v2 </span><span class="token operator" style="color:#66d9ef">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">3</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">FROM</span><span class="token plain"> a </span><span class="token keyword" style="color:#66d9ef">WHERE</span><span class="token plain"> v1 </span><span class="token operator" style="color:#66d9ef">+</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">10</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">3</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>PAX can handle complete expression trees, including nested <code>AND</code>/<code>OR</code> conditions. This means that all the above queries can be optimized, and Apache Cloudberry will use all available filter conditions to improve query efficiency.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="supported-expression-types">Supported expression types<a href="#supported-expression-types" class="hash-link" aria-label="Direct link to Supported expression types" title="Direct link to Supported expression types">​</a></h3>
<p>PAX sparse filtering supports the following expression types:</p>
<ul>
<li>
<p>Arithmetic operators (<code>OpExpr</code>)</p>
<ul>
<li>Supports addition (<code>+</code>), subtraction (<code>-</code>), and multiplication (<code>*</code>)</li>
<li>Division operations are not supported (due to difficulty in estimating negative number ranges)</li>
<li>Examples: <code>a + 1</code>, <code>1 - a</code>, <code>a * b</code></li>
</ul>
</li>
<li>
<p>Comparison operators (<code>OpExpr</code>)</p>
<ul>
<li>Supports <code>&lt;</code>, <code>&lt;=</code>, <code>=</code>, <code>&gt;=</code>, <code>&gt;</code></li>
<li>Examples: <code>a &lt; 1</code>, <code>a + 1 &lt; 10</code>, <code>a = b</code></li>
</ul>
</li>
<li>
<p>Logical operators (<code>BoolExpr</code>)</p>
<ul>
<li>Supports <code>AND</code>, <code>OR</code>, <code>NOT</code></li>
<li>Example: <code>a &lt; 10 AND b &gt; 10</code></li>
</ul>
</li>
<li>
<p>NULL value tests (<code>NullTest</code>)</p>
<ul>
<li>Supports <code>IS NULL</code>, <code>IS NOT NULL</code></li>
<li>Examples: <code>a IS NULL</code>, <code>a IS NOT NULL</code></li>
</ul>
</li>
<li>
<p>Type casting (<code>FuncExpr</code>)</p>
<ul>
<li>Only supports basic type casting</li>
<li>Example: <code>a::float8 &lt; 1.1</code></li>
<li>Custom functions are not supported, such as <code>func(a) &lt; 10</code></li>
</ul>
</li>
<li>
<p><code>IN</code> operator (<code>ScalarArrayOpExpr</code>)</p>
<ul>
<li>Supports <code>IN</code> expressions</li>
<li>Example: <code>a IN (1, 2, 3)</code></li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="partial-condition-support">Partial condition support<a href="#partial-condition-support" class="hash-link" aria-label="Direct link to Partial condition support" title="Direct link to Partial condition support">​</a></h3>
<p>When a query contains unsupported expressions (such as custom functions), PAX adopts a partial condition support strategy:</p>
<ul>
<li>Identifies and extracts supported conditions.</li>
<li>Uses supported conditions for sparse filtering.</li>
</ul>
<p>For example:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#8292a2;font-style:italic">-- Creates custom function v2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">CREATE</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">OR</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">REPLACE</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">FUNCTION</span><span class="token plain"> func</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">v2 </span><span class="token keyword" style="color:#66d9ef">double</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">precision</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">RETURNS</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">double</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">precision</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">AS</span><span class="token plain"> $$</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#66d9ef">RETURN</span><span class="token plain"> v2 </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">2</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">END</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">$$ </span><span class="token keyword" style="color:#66d9ef">LANGUAGE</span><span class="token plain"> plpgsql</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic">-- Uses custom function in query</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">FROM</span><span class="token plain"> a </span><span class="token keyword" style="color:#66d9ef">WHERE</span><span class="token plain"> v1 </span><span class="token operator" style="color:#66d9ef">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">3</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">AND</span><span class="token plain"> func</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">v2</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">10</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain">  </span><span class="token comment" style="color:#8292a2;font-style:italic">-- PAX will use v1 &lt; 3 for filtering</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In this example, although <code>func(v2) &lt; 10</code> cannot be used for sparse filtering, Apache Cloudberry still uses <code>v1 &lt; 3</code> to optimize query performance. This approach ensures that partial performance optimization is achieved even in complex queries.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><ul>
<li>The effectiveness of sparse filtering depends on data distribution and query conditions.</li>
<li>It is recommended to enable statistics on columns that are frequently used as filter conditions.</li>
<li>Certain conditions (such as custom functions) are ignored.</li>
</ul></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="view-data-change-records-on-pax-tables-in-wal-logs">View data change records on PAX tables in WAL logs<a href="#view-data-change-records-on-pax-tables-in-wal-logs" class="hash-link" aria-label="Direct link to View data change records on PAX tables in WAL logs" title="Direct link to View data change records on PAX tables in WAL logs">​</a></h2>
<p>Data operations related to PAX tables are recorded in the Write-Ahead Logging (WAL) system. This ensures reliable backups between primary and mirror nodes, which assists in failover processes.</p>
<p>You can use the <code>pg_waldump</code> tool to view the WAL logs for PAX tables. The logs are stored in the <code>$COORDINATOR_DATA_DIRECTORY/pg_wal</code> directory or the <code>pg_wal</code> directory within the Segment node&#x27;s data directory.</p>
<p>The PAX table WAL logs can be used for these purposes:</p>
<ul>
<li><strong>Data recovery</strong>: Helps restore data during system failures or data inconsistencies.</li>
<li><strong>Failover support</strong>: Ensures data synchronization between primary and mirror nodes.</li>
<li><strong>Debugging and analysis</strong>: Identifies and analyzes specific operations on PAX tables.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-operate-pax-tables-and-view-wal-logs">Example: operate PAX tables and view WAL logs<a href="#example-operate-pax-tables-and-view-wal-logs" class="hash-link" aria-label="Direct link to Example: operate PAX tables and view WAL logs" title="Direct link to Example: operate PAX tables and view WAL logs">​</a></h3>
<ol>
<li>
<p>Create a PAX table.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">TABLE</span><span class="token plain"> a </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">   v1 </span><span class="token keyword" style="color:#66d9ef">int</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">   v2 </span><span class="token keyword" style="color:#66d9ef">int</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">   v3 </span><span class="token keyword" style="color:#66d9ef">int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">USING</span><span class="token plain"> PAX</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This creates a PAX table <code>a</code> with columns <code>v1</code>, <code>v2</code>, and <code>v3</code>.</p>
</li>
<li>
<p>Insert data into the table:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">INTO</span><span class="token plain"> a </span><span class="token keyword" style="color:#66d9ef">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token number" style="color:#ae81ff">1</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">2</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">3</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Locate the node where the PAX table resides:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#8292a2;font-style:italic">-- Views the IDs and data directory locations of all nodes in the cluster</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">FROM</span><span class="token plain"> gp_segment_configuration</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic">-- Identifies the Segment ID of table a based on the results of the above query</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic">-- This helps determine the segment and data directory location of table a</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">SELECT</span><span class="token plain"> gp_segment_id </span><span class="token keyword" style="color:#66d9ef">FROM</span><span class="token plain"> gp_distribution_policy </span><span class="token keyword" style="color:#66d9ef">WHERE</span><span class="token plain"> localoid </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;a&#x27;</span><span class="token plain">::regclass</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Find the corresponding WAL log in the <code>pg_wal</code> directory of the identified node. For example:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">ls $COORDINATOR_DATA_DIRECTORY/pg_wal</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Locate the most recent WAL file to analyze the relevant operations. In this example, assume the WAL log file is named <code>00000001000000000000000A</code>.</p>
</li>
<li>
<p>Query the <code>relfilenode</code> of the PAX table to associate the WAL log with the PAX table:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">SELECT</span><span class="token plain"> relfilenode </span><span class="token keyword" style="color:#66d9ef">FROM</span><span class="token plain"> pg_class </span><span class="token keyword" style="color:#66d9ef">WHERE</span><span class="token plain"> relname </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;a&#x27;</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <code>relfilenode</code> is the unique identifier of the table in the WAL log.</p>
</li>
<li>
<p>Use the <code>pg_waldump</code> tool to parse the WAL log and identify operations related to the PAX table:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">pg_waldump -f $COORDINATOR_DATA_DIRECTORY/pg_wal/00000001000000000000000A</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In the output, search for the previously obtained <code>relfilenode</code> to find operations associated with the PAX table.</p>
<p>Example output of <code>pg_waldump</code>:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">rmgr: PAX       len (rec/tot):     68/   104, tx:    593, lsn: 0/016E1D98, prev 0/016E1D60, desc: INSERT off 3, blkref #0: rel 1663/16384/19780 blk 0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In this example:</p>
<ul>
<li><code>rmgr: PAX</code> indicates the record type.</li>
<li><code>rel 1663/16384/19780</code> corresponds to the <code>relfilenode</code> of the PAX table.</li>
<li><code>INSERT</code> indicates that an insert operation was recorded.</li>
</ul>
</li>
</ol>
<p>By following the steps above, you can track and analyze WAL logs related to PAX tables in Apache Cloudberry for debugging, recovery, or performance optimization purposes.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="limitations-for-pax-tables">Limitations for PAX tables<a href="#limitations-for-pax-tables" class="hash-link" aria-label="Direct link to Limitations for PAX tables" title="Direct link to Limitations for PAX tables">​</a></h2>
<ul>
<li>For index support, the PAX storage format currently only supports B-tree (<code>btree</code>) indexes. Bugs might occur when using GiST, SP-GiST (<code>gist/spgist</code>) or Brin indexes. Supports for other index types are still experimental and might be unavailable.</li>
<li>Currently, if a field is too long, it will be stored in a TOAST file. This TOAST is different from PostgreSQL&#x27;s TOAST tables, and they only share the same name.</li>
<li>Unlike traditional heap tables, PAX format does not support <code>TOAST</code> fields. Currently, all column data is stored in the same data file.</li>
<li>The PAX format does not support data backup and restore using <code>pg_dump</code> or <code>pg_restore</code>. PAX tables are ignored during these operations. You can use <code>pg_basebackup</code> to backup and restore PAX tables.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pax-related-sql-options">PAX-related SQL options<a href="#pax-related-sql-options" class="hash-link" aria-label="Direct link to PAX-related SQL options" title="Direct link to PAX-related SQL options">​</a></h2>
<p>PAX supports SQL options to control its behavior. You can use these options in the <code>WITH()</code> clause, for example, <code>WITH(minmax_columns=&#x27;b,c&#x27;, storage_format=porc)</code>.</p>
<table><thead><tr><th>Name</th><th>Type</th><th>Valid values</th><th>Description</th></tr></thead><tbody><tr><td><code>storage_format</code></td><td><code>string</code></td><td>•  <code>porc</code><br>•  <code>porc_vec</code></td><td>Controls the internal storage format. <code>porc</code> is the default value, which stores data in a regular format and does not preserve null values. <code>porc_vec</code> stores data in a vector format and always preserves null values for fixed-length fields, regardless of whether the column value is null or not.</td></tr><tr><td><code>compresstype</code></td><td><code>string</code></td><td>•  <code>none</code><br>•  <code>rle</code><br>•  <code>delta</code><br>•  <code>zstd</code><br>•  <code>zlib</code><br>•  <code>dict</code></td><td>Specifies the compression method for column values. You can only choose one method. The default value is <code>none</code>. <br><br>•  <code>none</code> means no compression is applied.<br>•  <code>rle</code> uses run-length encoding to compress repeated consecutive data.<br>•  <code>delta</code> is used for numeric columns, storing the difference between adjacent values.<br>•  <code>zstd</code> uses the zstd algorithm, which offers high compression ratio and fast compression speed.<br>•  <code>zlib</code> is a general-purpose compression algorithm, suitable for compressing general data.<br>•  <code>dict</code> uses dictionary encoding to speed up the processing of many repeated strings. Currently, it is an experimental feature and is not recommended for production use.</td></tr><tr><td><code>compresslevel</code></td><td><code>int</code></td><td>Range <code>[0, 19]</code></td><td>Indicates the compression level. The default value is <code>0</code>. A smaller value means faster compression, while a larger value provides higher compression. This option is only effective when used with <code>compresstype</code>.</td></tr><tr><td><code>partition_by</code></td><td><code>string</code></td><td>Valid column names in the table</td><td>When writing batch data, this option attempts to partition the data by the specified column and store it in the same data file, improving data locality. Only integer types are supported. This partition key is independent of table partitioning and serves as a suggestion for organizing data internally in PAX.</td></tr><tr><td><code>partition_ranges</code></td><td><code>string</code></td><td><code>FROM(XX) TO(YY) [every(DD)]</code></td><td>This option must be used with <code>partition_by</code> to set partition ranges. You can define a single range or divide a large range into multiple non-contiguous smaller ranges. It attempts to store data within each range in the same data file. Data outside the range will be stored in the default data file.</td></tr><tr><td><code>minmax_columns</code></td><td><code>string</code></td><td>Valid column names in the table, separated by commas</td><td>Records <code>minmax</code> statistics for the defined columns to speed up data queries. After renaming a column, the statistics will no longer be recorded for that column. If you modify <code>minmax_columns</code> using <code>ALTER TABLE</code>, the change only applies to data files written afterward and does not affect existing data files.</td></tr><tr><td><code>cluster_columns</code></td><td><code>string</code></td><td>A comma-separated list of valid column names in the table.</td><td>Indicates that the PAX table stores the internal data in a clustered way. When using the <code>cluster</code> command, the data can be sorted by these columns, and the sorting method is controlled by the <code>cluster_type</code> parameter.</td></tr><tr><td><code>bloomfilter_columns</code></td><td><code>string</code></td><td>A comma-separated list of valid column names in the table.</td><td>Calculates bloom filters for the data in the specified columns to help data filtering.</td></tr><tr><td><code>parallel_workers</code></td><td><code>int</code></td><td><code>[0,64]</code></td><td>A PostgreSQL option that sets the number of parallel processes for concurrent scanning.</td></tr><tr><td><code>cluster_type</code></td><td><code>string</code></td><td><code>lexical</code> and <code>zorder</code></td><td>Specifies the cluster type when clustering is based on custom columns defined in <code>reloptions</code> rather than an index. Valid values are <code>lexical</code> and <code>zorder</code>. <code>lexical</code> sorts by the values and order of the columns, while <code>zorder</code> encodes the values of multiple columns into a byte array and sorts by that array.</td></tr></tbody></table>
<p>The values of these options only affect newly inserted and updated data and do not change the existing data.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pax-related-system-parameters">PAX-related system parameters<a href="#pax-related-system-parameters" class="hash-link" aria-label="Direct link to PAX-related system parameters" title="Direct link to PAX-related system parameters">​</a></h2>
<p>The following system parameters (GUC) are used to set the behavior of PAX tables in the current session. Use the command <code>SET &lt;parameter&gt;=&lt;value&gt;</code> to configure them, for example, <code>SET pax_enable_sparse_filter=on</code>.</p>
<table><thead><tr><th>Parameter name</th><th>Value type</th><th>Valid values</th><th>Description</th></tr></thead><tbody><tr><td><code>pax_enable_sparse_filter</code></td><td><code>bool</code></td><td><code>on</code> and <code>off</code></td><td>Specifies whether to enable sparse filtering based on statistics. The default value is <code>on</code>, which means that sparse filtering is enabled by default.</td></tr><tr><td><code>pax_enable_row_filter</code></td><td><code>bool</code></td><td><code>on</code> and <code>off</code></td><td>Specifies whether to enable row filtering. The default value is <code>off</code>, which means that row filtering is disabled. It is not recommended to enable this parameter.</td></tr><tr><td><code>pax_scan_reuse_buffer_size</code></td><td><code>int</code></td><td>Range <code>[1048576, 33554432]</code> (1MiB to 32MiB)</td><td>The buffer block size used during scanning. The default value is <code>8388608</code> (8MiB).</td></tr><tr><td><code>pax_max_tuples_per_group</code></td><td><code>int</code></td><td>Range <code>[5, 524288]</code></td><td>Specifies the maximum number of tuples allowed in each group. The default value is <code>131072</code>.</td></tr><tr><td><code>pax_max_tuples_per_file</code></td><td><code>int</code></td><td>Range <code>[131072, 8388608]</code></td><td>Specifies the maximum number of tuples allowed in each data file. The maximum value is <code>8388608</code>. The default value is <code>1310720</code>.</td></tr><tr><td><code>pax_max_size_per_file</code></td><td><code>int</code></td><td>Range <code>[8388608, 335544320]</code> (8MiB to 320MiB)</td><td>The maximum physical size allowed for each data file. The default value is <code>67108864</code> (64MiB). The actual file size might be slightly larger than the set size. Very large or small values might negatively impact performance.</td></tr><tr><td><code>pax_enable_toast</code></td><td><code>bool</code></td><td><code>on</code> and <code>off</code>. The default value is <code>on</code>.</td><td>Specifies whether to enable TOAST support.</td></tr><tr><td><code>pax_min_size_of_compress_toast</code></td><td><code>int</code></td><td>Range <code>[524288, 1073741824]</code> (512KiB to 1GiB). The default value is <code>524288</code> (512KiB).</td><td>Specifies the threshold for creating compressed TOAST tables. If the character length exceeds this threshold, Apache Cloudberry creates compressed TOAST tables for storage.</td></tr><tr><td><code>pax_min_size_of_external_toast</code></td><td><code>int</code></td><td>Range <code>[10485760, 2147483647]</code> (10MiB to 2GiB). The default value is <code>10485760</code> (10MiB).</td><td>Specifies the threshold for creating external TOAST tables. If the character length exceeds this threshold, Apache Cloudberry creates external TOAST tables for storage.</td></tr><tr><td><code>pax_default_storage_format</code></td><td><code>string</code></td><td><code>porc</code> (the default value)</td><td>Controls the default storage format.</td></tr><tr><td><code>pax_bloom_filter_work_memory_bytes</code></td><td><code>int</code></td><td>Range <code>[1024, 2147483647]</code> (1KiB to 2GiB). The default value is <code>10240</code> (10KiB).</td><td>Controls the maximum memory allowed for bloom filter usage.</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="best-practices">Best practices<a href="#best-practices" class="hash-link" aria-label="Direct link to Best practices" title="Direct link to Best practices">​</a></h2>
<ul>
<li>
<p>Use partitioning options:</p>
<ul>
<li>
<p>It is recommended to use partitioning options when data needs to be imported based on an integer column and meets the following conditions:</p>
<ul>
<li>The data is evenly distributed across this column, with a wide range and no extreme concentration.</li>
<li>This column is often used as a filter condition in queries or as a key for joins.</li>
</ul>
</li>
<li>
<p>Keep in mind that the PAX partition key is only effective during a single batch data import. It cannot be adjusted between multiple data writes. The partition key settings only apply to future inserts or updates, so after changing the partition key, newly imported data will follow the new partition key.</p>
</li>
</ul>
</li>
<li>
<p>Use <code>minmax</code> statistics:</p>
<ul>
<li>For columns with a wide data range that are often used in query filters, setting <code>minmax</code> values for these columns can greatly speed up the query process.</li>
<li>By using <code>minmax</code> statistics, if a column in a data file does not match the <code>minmax</code> values or null tests, the entire file can be skipped quickly, avoiding unnecessary data scans.</li>
<li>Important note: The effectiveness of <code>minmax</code> depends on how data is inserted. If the data in a PAX table is inserted in batches (such as with <code>batch insert</code> or <code>copy</code>) and the data range within each batch is continuous, then <code>minmax</code> will be very effective. However, if the data is inserted randomly, the effectiveness of <code>minmax</code> filtering may be reduced.</li>
</ul>
</li>
<li>
<p>If a PAX table has multiple columns used in query filters, you can use <code>with(cluster_columns=&#x27;b,c,d&#x27;, cluster_type=&#x27;zorder&#x27;)</code>. After sorting the data with <code>zorder</code> encoding, any of the <code>cluster_columns</code> can benefit from filtering. In comparison, for single-column-based cluster sorting, filtering is only effective on the sorted key, with minimal impact on other columns. Clustering sorting influences <code>minmax</code>-based filtering but does not affect <code>bloom filter</code>-based filtering.</p>
</li>
<li>
<p>If your query uses filters like <code>column1 in (12, 11, 13)</code> or <code>column1 = &#x27;X&#x27;</code>, you might consider using a <code>bloom filter (with(bloomfilter_columns=&#x27;b,c&#x27;))</code>. In internal implementation, PAX calculates bloom filters for certain data. If the bloom filter can confirm that the data is not in the block, PAX can skip the current block. Note that the effectiveness of bloom filter depends on several factors:</p>
<ul>
<li>The amount of data within a <code>group</code>.</li>
<li>The space used by the <code>bloom filter</code>.</li>
</ul>
</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/apache/cloudberry-site/edit/main/versioned_docs/version-2.x/operate-with-data/pax-table-format.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_VsjB"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-09-19T03:10:26.000Z">Sep 19, 2025</time></b> by <b>Dianjin Wang</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/operate-with-data/heap-and-ao-table-formats"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label single-line-overflow hide-before-after">Heap and AO Table Formats</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/operate-with-data/work-with-transactions"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label single-line-overflow hide-before-after">Work with Transactions</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_jeP5 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#applicable-scenarios" class="table-of-contents__link toc-highlight">Applicable scenarios</a></li><li><a href="#enable-pax-when-building-cloudberry-from-source-code" class="table-of-contents__link toc-highlight">Enable PAX when building Cloudberry from source code</a></li><li><a href="#usage" class="table-of-contents__link toc-highlight">Usage</a></li><li><a href="#support-for-toast" class="table-of-contents__link toc-highlight">Support for TOAST</a></li><li><a href="#support-for-clustering" class="table-of-contents__link toc-highlight">Support for clustering</a></li><li><a href="#bloom-filter-support" class="table-of-contents__link toc-highlight">Bloom filter support</a></li><li><a href="#sparse-filtering" class="table-of-contents__link toc-highlight">Sparse filtering</a></li><li><a href="#view-data-change-records-on-pax-tables-in-wal-logs" class="table-of-contents__link toc-highlight">View data change records on PAX tables in WAL logs</a></li><li><a href="#limitations-for-pax-tables" class="table-of-contents__link toc-highlight">Limitations for PAX tables</a></li><li><a href="#pax-related-sql-options" class="table-of-contents__link toc-highlight">PAX-related SQL options</a></li><li><a href="#pax-related-system-parameters" class="table-of-contents__link toc-highlight">PAX-related system parameters</a></li><li><a href="#best-practices" class="table-of-contents__link toc-highlight">Best practices</a></li></ul></div></div></div></div></main></div></div></div><div class="wrap_QlFE"><div class="mainWrap_IbWk"><div class="linksWrap_Zcc4"><div><div class="footerLinkTitle_PxTg">Support</div><div class="footerLinkItem_Kf4k"><a href="https://github.com/apache/cloudberry/issues" target="_blank" rel="noopener noreferrer">GitHub Issues</a></div><div class="footerLinkItem_Kf4k"><a href="https://github.com/apache/cloudberry/discussions" target="_blank" rel="noopener noreferrer">GitHub Discussions</a></div><div class="footerLinkItem_Kf4k"><a href="https://inviter.co/apache-cloudberry" target="_blank" rel="noopener noreferrer">Slack</a></div><div class="footerLinkItem_Kf4k"><a href="https://x.com/ASFCloudberry" target="_blank" rel="noopener noreferrer">Twitter</a></div><div class="footerLinkItem_Kf4k"><a href="https://youtube.com/@ApacheCloudberry" target="_blank" rel="noopener noreferrer">Youtube</a></div><div class="footerLinkItem_Kf4k"><a target="_self" href="/community/security">Security</a></div></div><div><div class="footerLinkTitle_PxTg">Resources</div><div class="footerLinkItem_Kf4k"><a href="/releases" target="_blank">Download</a></div><div class="footerLinkItem_Kf4k"><a target="_self" href="/docs/">Documentation</a></div><div class="footerLinkItem_Kf4k"><a target="_self" href="/community/events">Events</a></div><div class="footerLinkItem_Kf4k"><a href="/community/brand" target="_blank">Brand Guidelines</a></div></div><div><div class="footerLinkTitle_PxTg">Contribution</div><div class="footerLinkItem_Kf4k"><a target="_self" href="/contribute/git">Working with Git &amp; GitHub</a></div><div class="footerLinkItem_Kf4k"><a target="_self" href="/contribute/how-to-contribute">Contribution Overview</a></div><div class="footerLinkItem_Kf4k"><a target="_self" href="/contribute/code">Code Contribution</a></div><div class="footerLinkItem_Kf4k"><a target="_self" href="/contribute/doc">Doc Contribution</a></div></div></div><div class="logoLinkWrap_MDp5"><div class="logoWrap_qcVI"><img class="logo_cphB" src="/img/apache-incubator.svg" alt=""></div><div class="links_yA93"><svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" class="item_KKoc" cursor="pointer"><path d="M15.002 0c-8.288 0-15 6.713-15 15 0 6.637 4.293 12.244 10.256 14.231.75.131 1.031-.319 1.031-.712 0-.356-.019-1.538-.019-2.794-3.769.694-4.744-.919-5.044-1.763-.168-.43-.9-1.762-1.537-2.118-.525-.282-1.275-.975-.019-.994 1.181-.019 2.025 1.087 2.306 1.537 1.35 2.27 3.507 1.632 4.37 1.238.13-.975.524-1.631.956-2.006-3.338-.375-6.826-1.669-6.826-7.406 0-1.632.582-2.982 1.538-4.032-.15-.375-.675-1.912.15-3.975 0 0 1.256-.394 4.125 1.538 1.2-.338 2.475-.506 3.75-.506s2.55.168 3.75.506c2.869-1.95 4.125-1.538 4.125-1.538.825 2.063.3 3.6.15 3.975.956 1.05 1.538 2.382 1.538 4.032 0 5.756-3.507 7.03-6.844 7.406.544.468 1.012 1.369 1.012 2.775 0 2.006-.018 3.619-.018 4.125 0 .394.28.862 1.03.712A15.024 15.024 0 0 0 30.003 15c0-8.287-6.713-15-15-15Z"></path></svg><svg width="32" height="26" viewBox="0 0 32 26" fill="none" xmlns="http://www.w3.org/2000/svg" class="item_KKoc" cursor="pointer"><path d="M31.319 3.484c-1.145.507-2.36.84-3.603.987a6.293 6.293 0 0 0 2.758-3.47 12.518 12.518 0 0 1-3.983 1.52A6.274 6.274 0 0 0 15.64 6.815c0 .493.056.97.161 1.43a17.811 17.811 0 0 1-12.93-6.555 6.252 6.252 0 0 0-.85 3.154 6.272 6.272 0 0 0 2.791 5.222 6.253 6.253 0 0 1-2.841-.785l-.001.077a6.277 6.277 0 0 0 5.033 6.153 6.305 6.305 0 0 1-2.834.108 6.278 6.278 0 0 0 5.86 4.356 12.59 12.59 0 0 1-7.79 2.686c-.5 0-1-.03-1.497-.088a17.746 17.746 0 0 0 9.616 2.818c11.54 0 17.849-9.559 17.849-17.848 0-.272-.007-.544-.019-.812a12.746 12.746 0 0 0 3.13-3.246Z"></path></svg><svg width="30" height="24" viewBox="0 0 30 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="item_KKoc" cursor="pointer"><path d="M15.366 0c.801.004 2.805.024 4.935.11l.755.032c2.145.102 4.287.275 5.35.571 1.417.398 2.53 1.56 2.907 3.033.6 2.339.675 6.903.684 8.008l.002.229v.032l-.002.229c-.009 1.104-.084 5.669-.684 8.008-.381 1.478-1.495 2.64-2.907 3.032-1.063.297-3.205.47-5.35.571l-.755.033c-2.13.086-4.134.105-4.935.11h-.734c-1.696-.01-8.785-.087-11.04-.714-1.418-.398-2.532-1.56-2.908-3.032-.6-2.34-.675-6.904-.684-8.008v-.49c.01-1.105.084-5.67.684-8.008.382-1.478 1.496-2.64 2.908-3.033C5.847.086 12.936.01 14.632 0h.734Zm-3.367 6.749v10.5l9-5.25-9-5.25Z"></path></svg><svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" class="item_KKoc" cursor="pointer"><path d="M6.791 18.77a2.959 2.959 0 0 1-2.952 2.952 2.959 2.959 0 0 1-2.951-2.951 2.959 2.959 0 0 1 2.951-2.952h2.952v2.952Zm1.487 0a2.959 2.959 0 0 1 2.952-2.951 2.959 2.959 0 0 1 2.952 2.952v7.39a2.959 2.959 0 0 1-2.952 2.952 2.959 2.959 0 0 1-2.952-2.952v-7.39ZM11.23 6.792A2.959 2.959 0 0 1 8.278 3.84 2.959 2.959 0 0 1 11.23.888a2.959 2.959 0 0 1 2.952 2.951v2.952H11.23Zm0 1.487a2.959 2.959 0 0 1 2.952 2.952 2.959 2.959 0 0 1-2.952 2.952H3.84A2.959 2.959 0 0 1 .887 11.23a2.959 2.959 0 0 1 2.951-2.952h7.391Zm11.98 2.952a2.959 2.959 0 0 1 2.951-2.952 2.959 2.959 0 0 1 2.952 2.952 2.959 2.959 0 0 1-2.952 2.952H23.21V11.23Zm-1.488 0a2.959 2.959 0 0 1-2.951 2.952 2.959 2.959 0 0 1-2.952-2.952V3.84A2.959 2.959 0 0 1 18.771.887a2.959 2.959 0 0 1 2.951 2.951v7.391Zm-2.951 11.98a2.959 2.959 0 0 1 2.951 2.951 2.959 2.959 0 0 1-2.951 2.952 2.959 2.959 0 0 1-2.952-2.952V23.21h2.952Zm0-1.488a2.959 2.959 0 0 1-2.952-2.951 2.959 2.959 0 0 1 2.952-2.952h7.39a2.959 2.959 0 0 1 2.952 2.952 2.959 2.959 0 0 1-2.952 2.951h-7.39Z"></path></svg><svg width="28" height="30" viewBox="0 0 28 30" fill="none" xmlns="http://www.w3.org/2000/svg" class="item_KKoc" cursor="pointer"><path d="M22.48 4.286H5.195c-.845 0-1.52.724-1.52 1.568v18.579c0 .844.675 1.568 1.52 1.568h17.283c.845 0 1.52-.724 1.52-1.568V5.854c0-.844-.675-1.568-1.52-1.568Z"></path><path d="M6.233 12.156h3.081v10.756H6.233V12.156Zm1.57-5.315c.988 0 1.802.875 1.802 1.938s-.814 1.939-1.803 1.939C6.814 10.718 6 9.842 6 8.779c0-1.063.814-1.938 1.802-1.938Zm3.488 5.315h2.965v1.439h.058c.407-.876 1.453-1.751 2.965-1.751 3.14 0 3.721 2.25 3.721 5.127v5.879h-3.081v-5.253c0-1.25 0-2.877-1.628-2.877s-1.86 1.376-1.86 2.752v5.315h-3.082v-10.63h-.058Z" fill="#000"></path></svg><svg width="34" height="28" viewBox="0 0 34 28" fill="none" xmlns="http://www.w3.org/2000/svg" class="item_KKoc" cursor="pointer"><path d="M26.863 16.567c.748 0 1.347-.636 1.347-1.347 0-.748-.599-1.347-1.347-1.347s-1.347.599-1.347 1.347.599 1.347 1.347 1.347Zm-6.639 0c.749 0 1.347-.636 1.347-1.347 0-.748-.598-1.347-1.347-1.347-.748 0-1.346.599-1.346 1.347s.598 1.347 1.346 1.347Zm9.852 7.56a.52.52 0 0 0-.258.553c0 .074 0 .148.036.221.148.627.442 1.622.442 1.66 0 .11.037.184.037.257a.33.33 0 0 1-.331.332c-.074 0-.11-.037-.184-.074l-2.174-1.253c-.147-.074-.331-.147-.516-.147-.11 0-.22 0-.294.037-1.032.294-2.1.442-3.242.442-5.49 0-9.91-3.687-9.91-8.258 0-4.57 4.42-8.257 9.91-8.257 5.489 0 9.91 3.686 9.91 8.257 0 2.47-1.327 4.719-3.427 6.23ZM24.01 8.147a13.662 13.662 0 0 0-.418-.007c-6.262 0-11.41 4.29-11.41 9.757 0 .83.119 1.634.342 2.4h-.133c-1.33 0-2.659-.221-3.877-.553-.111-.037-.222-.037-.333-.037-.221 0-.443.074-.627.185L4.932 21.4a.525.525 0 0 1-.221.074.409.409 0 0 1-.406-.405c0-.11.036-.184.073-.294.037-.037.37-1.251.554-1.987 0-.074.037-.184.037-.258a.834.834 0 0 0-.332-.662C2.089 16.065.5 13.378.5 10.398.501 4.916 5.855.5 12.428.5 18.073.5 22.82 3.753 24.01 8.146Zm-7.73.627c.859 0 1.54-.716 1.54-1.54 0-.858-.681-1.539-1.54-1.539-.86 0-1.54.68-1.54 1.54 0 .859.68 1.54 1.54 1.54Zm-7.89 0c.86 0 1.54-.716 1.54-1.54 0-.858-.68-1.539-1.54-1.539-.859 0-1.539.68-1.539 1.54 0 .859.68 1.54 1.54 1.54Z"></path></svg></div></div></div><div class="copyrightWrap_yPz7"><div class="copyright_AoBa">
      <p>
        Apache Cloudberry is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.
      </p>
      <p>
        Copyright © 2025 The Apache Software Foundation, Licensed under the Apache License, Version 2.0.</p>
      <p>
        Apache®, the names of Apache projects, and the feather logo are either registered trademarks or trademarks of the Apache Software Foundation in the United States and/or other countries.
      </p>
      </div></div></div></div>
</body>
</html>