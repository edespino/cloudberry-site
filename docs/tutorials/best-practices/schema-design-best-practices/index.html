<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-2.x docs-doc-page docs-doc-id-tutorials/best-practices/schema-design-best-practices" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">Schema Design Best Practices | Apache Cloudberry (Incubating)</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://cloudberry.apache.org/docs/tutorials/best-practices/schema-design-best-practices"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="zh"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="2.x"><meta data-rh="true" name="docusaurus_tag" content="docs-default-2.x"><meta data-rh="true" name="docsearch:version" content="2.x"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-2.x"><meta data-rh="true" property="og:title" content="Schema Design Best Practices | Apache Cloudberry (Incubating)"><meta data-rh="true" name="description" content="Best practices for designing Apache Cloudberry schemas."><meta data-rh="true" property="og:description" content="Best practices for designing Apache Cloudberry schemas."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://cloudberry.apache.org/docs/tutorials/best-practices/schema-design-best-practices"><link data-rh="true" rel="alternate" href="https://cloudberry.apache.org/docs/tutorials/best-practices/schema-design-best-practices" hreflang="en"><link data-rh="true" rel="alternate" href="https://cloudberry.apache.org/zh/docs/tutorials/best-practices/schema-design-best-practices" hreflang="zh"><link data-rh="true" rel="alternate" href="https://cloudberry.apache.org/docs/tutorials/best-practices/schema-design-best-practices" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache Cloudberry (Incubating) is one advanced and mature open-source MPP (Massively Parallel Processing) databases available. RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache Cloudberry (Incubating) is one advanced and mature open-source MPP (Massively Parallel Processing) databases available. Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title="Apache Cloudberry (Incubating) is one advanced and mature open-source MPP (Massively Parallel Processing) databases available. JSON Feed">




<link rel="preconnect" href="https://analytics.apache.org/">
<script>var _paq=window._paq=window._paq||[];_paq.push(["setRequestMethod","POST"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),_paq.push(["enableHeartBeatTimer"]),function(){var e="https://analytics.apache.org/";_paq.push(["setRequestMethod","POST"]),_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","66"]);var a=document,t=a.createElement("script"),p=a.getElementsByTagName("script")[0];t.type="text/javascript",t.async=!0,t.src=e+"matomo.js",p.parentNode.insertBefore(t,p)}()</script><link rel="stylesheet" href="/assets/css/styles.2571dcd9.css">
<script src="/assets/js/runtime~main.71593b55.js" defer="defer"></script>
<script src="/assets/js/main.103148e8.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?t("light"):t("dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="tipsWrap_WWTe"><div class="tipsContent_sMsy"><div class="text_VINd"><a href="https://github.com/apache/cloudberry" target="_blank" rel="noopener noreferrer"><span>If you like Apache Cloudberry (Incubating), give it a star on GitHub! </span><img src="/img/home/hcard/star.svg" alt=""></a></div><div class="close_vVex"><img src="/img/home/hcard/close.svg" alt=""></div></div></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div class="nav-left-logo"><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/apache_cloudberry_color_black.svg" alt="Apache Cloudberry (Incubating)" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/apache_cloudberry_color_white.svg" alt="Apache Cloudberry (Incubating)" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a></div><div class="navbar__item dropdown dropdown--hoverable"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" versions="current,2.x,1.x" href="/docs/">2.x</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/tutorials/best-practices/schema-design-best-practices">Next</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/tutorials/best-practices/schema-design-best-practices">2.x</a></li><li><a class="dropdown__link" href="/docs/1.x/">1.x</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Community</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/community">Overview</a></li><li><a class="dropdown__link" href="/community/slack">Slack Guide</a></li><li><a class="dropdown__link" href="/community/wechat">WeChat Guide</a></li><li><a class="dropdown__link" href="/community/events">Community Events</a></li><li><a class="dropdown__link" href="/community/mailing-lists">Mailing Lists</a></li><li><a class="dropdown__link" href="/community/brand">Brand Guidelines</a></li><li><a class="dropdown__link" href="/community/security">Security Policy</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Contribute</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/contribute">Overview</a></li><li><a class="dropdown__link" href="/contribute/how-to-contribute">How to Contribute</a></li><li><a class="dropdown__link" href="/contribute/git">Working with Git &amp; GitHub</a></li><li><a class="dropdown__link" href="/contribute/code">Code Contribution Guide</a></li><li><a class="dropdown__link" href="/contribute/proposal">Proposal Guide</a></li><li><a class="dropdown__link" href="/contribute/doc">Doc Contribution Guide</a></li></ul></div><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/releases">Download</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Team</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/team">Who we are</a></li><li><a class="dropdown__link" href="/team/new-committers">Inviting New Committers</a></li><li><a class="dropdown__link" href="/team/sign-icla">Sign ICLA</a></li><li><a class="dropdown__link" href="/team/setup-apache-email-account">Setup the Apache account</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Resources</a><ul class="dropdown__menu"><li><a href="https://github.com/apache/cloudberry/wiki" target="_blank" rel="noopener noreferrer" class="dropdown__link">Wiki</a></li><li><a href="https://github.com/apache/cloudberry/discussions/868" target="_blank" rel="noopener noreferrer" class="dropdown__link">Roadmap</a></li><li><a href="https://github.com/apache/cloudberry/discussions" target="_blank" rel="noopener noreferrer" class="dropdown__link">Forum</a></li><li><a class="dropdown__link" href="/support">Support</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">ASF</a><ul class="dropdown__menu"><li><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Foundation</a></li><li><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="dropdown__link">License</a></li><li><a href="https://www.apache.org/events/current-event.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Events</a></li><li><a href="https://privacy.apache.org/policies/privacy-policy-public.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Privacy</a></li><li><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Security</a></li><li><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Sponsorship</a></li><li><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Thanks</a></li><li><a href="https://www.apache.org/foundation/policies/conduct" target="_blank" rel="noopener noreferrer" class="dropdown__link">Code of Conduct</a></li></ul></div><div class="toggle_vylO colorModeToggle_x44X check-theme-switch"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_dCNk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_BF9v"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_Rg9N"><aside class="theme-doc-sidebar-container docSidebarContainer_RSuS"><div class="sidebarViewport_pYEE"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/">Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/deployment/">Deploy and Build</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/data-loading/">Load Data</a><button aria-label="Expand sidebar category &#x27;Load Data&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/operate-with-data/operate-with-db-objects/create-and-manage-database">Create and Prepare</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/operate-with-data/operate-with-db-objects/create-and-manage-tablespaces">Operate with Data</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/performance/define-database-performance">Optimize Performance</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/security/">Security and Permission</a><button aria-label="Expand sidebar category &#x27;Security and Permission&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/sys-admin/backup-and-restore/">Manage System</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/developer/develop-extensions-using-rust">Developer</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/ecosystem/sql-clients/dbeaver">Ecosystem</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/sql-stmts/">References</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/tutorials/crash-course">Tutorials</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/crash-course">Apache Cloudberry Crash Course</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/tutorials/quick-trial-lessons/">Quick Trial Lessons</a><button aria-label="Expand sidebar category &#x27;Quick Trial Lessons&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/tutorials/product-principles/about-mvcc">Product Principles</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/tutorials/best-practices/">Best Practices</a><button aria-label="Collapse sidebar category &#x27;Best Practices&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/tutorials/best-practices/schema-design-best-practices">Schema Design Best Practices</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/best-practices/load-data-best-practices">Load Data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/best-practices/db-encryption-best-practices">Encrypt Data and Database Connections</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/best-practices/high-availability-best-practices">High Availability</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/best-practices/resource-group-best-practices">Memory and Resource Management with Resource Groups</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/best-practices/system-configuration-best-practices">System Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/best-practices/system-monitor-and-maintain-best-practices">System Monitoring and Maintenance</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/best-practices/manage-bloat">Manage Bloat in a Database</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/best-practices/identify-and-mitigate-heap-table-performance-issues">Identify and Mitigate Heap Table Performance Issues</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/best-practices/security-best-practices">Security</a></li></ul></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_hjYf"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_z5aJ"><div class="docItemContainer_c0TR"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Alpn" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_xK9p"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link" id="支付">Tutorials</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><span class="breadcrumbs__link" style="cursor:pointer">Best Practices</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Schema Design Best Practices</span><meta itemprop="position" content="3"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: 2.x</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_bxCs"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Schema Design Best Practices</h1>
<p>Best practices for designing Apache Cloudberry schemas.</p>
<p>Apache Cloudberry is an analytical, shared-nothing database, which is much different than a highly normalized, transactional SMP database. Apache Cloudberry performs best with a denormalized schema design suited for MPP analytical processing, a star or snowflake schema, with large centralized fact tables connected to multiple smaller dimension tables.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="data-types">Data types<a href="#data-types" class="hash-link" aria-label="Direct link to Data types" title="Direct link to Data types">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="use-types-consistently">Use types consistently<a href="#use-types-consistently" class="hash-link" aria-label="Direct link to Use types consistently" title="Direct link to Use types consistently">​</a></h3>
<p>Use the same data types for columns used in joins between tables. If the data types differ, Apache Cloudberry must dynamically convert the data type of one of the columns so the data values can be compared correctly. With this in mind, you may need to increase the data type size to facilitate joins to other common objects.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="choose-data-types-that-use-the-least-space">Choose data types that use the least space<a href="#choose-data-types-that-use-the-least-space" class="hash-link" aria-label="Direct link to Choose data types that use the least space" title="Direct link to Choose data types that use the least space">​</a></h3>
<p>You can increase database capacity and improve query execution by choosing the most efficient data types to store your data.</p>
<p>Use <code>TEXT</code> or <code>VARCHAR</code> rather than <code>CHAR</code>. There are no performance differences among the character data types, but using <code>TEXT</code> or <code>VARCHAR</code> can decrease the storage space used.</p>
<p>Use the smallest numeric data type that will accommodate your data. Using <code>BIGINT</code> for data that fits in <code>INT</code> or <code>SMALLINT</code> wastes storage space.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="storage-model">Storage model<a href="#storage-model" class="hash-link" aria-label="Direct link to Storage model" title="Direct link to Storage model">​</a></h2>
<p>Apache Cloudberry provides an array of storage options when creating tables. It is very important to know when to use heap storage versus append-optimized (AO) storage, and when to use row-oriented storage versus column-oriented storage. The correct selection of heap versus AO and row versus column is extremely important for large fact tables, but less important for small dimension tables.</p>
<p>The best practices for determining the storage model are:</p>
<ol>
<li>Design and build an insert-only model, truncating a daily partition before load.</li>
<li>For large partitioned fact tables, evaluate and use optimal storage options for different partitions. One storage option is not always right for the entire partitioned table. For example, some partitions can be row-oriented while others are column-oriented.</li>
<li>When using column-oriented storage, every column is a separate file on <em>every</em> Apache Cloudberry segment. For tables with a large number of columns consider columnar storage for data often accessed (hot) and row-oriented storage for data not often accessed (cold).</li>
<li>Storage options should be set at the partition level.</li>
<li>Compress large tables to improve I/O performance and to make space in the cluster.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="heap-storage-or-append-optimized-storage">Heap storage or append-optimized storage<a href="#heap-storage-or-append-optimized-storage" class="hash-link" aria-label="Direct link to Heap storage or append-optimized storage" title="Direct link to Heap storage or append-optimized storage">​</a></h3>
<p>Heap storage is the default model, and is the model PostgreSQL uses for all database tables. Use heap storage for tables and partitions that will receive iterative <code>UPDATE</code>, <code>DELETE</code>, and singleton <code>INSERT</code> operations. Use heap storage for tables and partitions that will receive concurrent <code>UPDATE</code>, <code>DELETE</code>, and <code>INSERT</code> operations.</p>
<p>Use append-optimized storage for tables and partitions that are updated infrequently after the initial load and have subsequent inserts performed only in batch operations. Avoid performing singleton <code>INSERT</code>, <code>UPDATE</code>, or <code>DELETE</code> operations on append-optimized tables. Concurrent batch <code>INSERT</code> operations are acceptable, but <em>never</em> perform concurrent batch <code>UPDATE</code> or <code>DELETE</code> operations.</p>
<p>The append-optimized storage model is inappropriate for frequently updated tables, because space occupied by rows that are updated and deleted in append-optimized tables is not recovered and reused as efficiently as with heap tables. Append-optimized storage is intended for large tables that are loaded once, updated infrequently, and queried frequently for analytical query processing.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="row-or-column-orientation">Row or column orientation<a href="#row-or-column-orientation" class="hash-link" aria-label="Direct link to Row or column orientation" title="Direct link to Row or column orientation">​</a></h3>
<p>Row orientation is the traditional way to store database tuples. The columns that comprise a row are stored on disk contiguously, so that an entire row can be read from disk in a single I/O.</p>
<p>Column orientation stores column values together on disk. A separate file is created for each column. If the table is partitioned, a separate file is created for each column and partition. When a query accesses only a small number of columns in a column-oriented table with many columns, the cost of I/O is substantially reduced compared to a row-oriented table; any columns not referenced do not have to be retrieved from disk.</p>
<p>Row-oriented storage is recommended for transactional type workloads with iterative transactions where updates are required and frequent inserts are performed. Use row-oriented storage when selects against the table are wide, where many columns of a single row are needed in a query. If the majority of columns in the <code>SELECT</code> list or <code>WHERE</code> clause is selected in queries, use row-oriented storage. Use row-oriented storage for general purpose or mixed workloads, as it offers the best combination of flexibility and performance.</p>
<p>Column-oriented storage is optimized for read operations but it is not optimized for write operations; column values for a row must be written to different places on disk. Column-oriented tables can offer optimal query performance on large tables with many columns where only a small subset of columns are accessed by the queries.</p>
<p>Another benefit of column orientation is that a collection of values of the same data type can be stored together in less space than a collection of mixed type values, so column-oriented tables use less disk space (and consequently less disk I/O) than row-oriented tables. Column-oriented tables also compress better than row-oriented tables.</p>
<p>Use column-oriented storage for data warehouse analytic workloads where selects are narrow or aggregations of data are computed over a small number of columns. Use column-oriented storage for tables that have single columns that are regularly updated without modifying other columns in the row. Reading a complete row in a wide columnar table requires more time than reading the same row from a row-oriented table. It is important to understand that each column is a separate physical file on <em>every</em> segment in Apache Cloudberry.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="compression">Compression<a href="#compression" class="hash-link" aria-label="Direct link to Compression" title="Direct link to Compression">​</a></h2>
<p>Apache Cloudberry offers a variety of options to compress append-optimized tables and partitions. Use compression to improve I/O across the system by allowing more data to be read with each disk read operation. The best practice is to set the column compression settings at the partition level.</p>
<p>Note that new partitions added to a partitioned table do not automatically inherit compression defined at the table level; you must <em>specifically</em> define compression when you add new partitions.</p>
<p>Run-length encoding (RLE) compression provides the best levels of compression. Higher levels of compression usually result in more compact storage on disk, but require additional time and CPU cycles when compressing data on writes and uncompressing on reads. Sorting data, in combination with the various compression options, can achieve the highest level of compression.</p>
<p>Data compression should never be used for data that is stored on a compressed file system.</p>
<p>Test different compression types and ordering methods to determine the best compression for your specific data. For example, you might start zstd compression at level 8 or 9 and adjust for best results. RLE compression works best with files that contain repetitive data.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="distributions">Distributions<a href="#distributions" class="hash-link" aria-label="Direct link to Distributions" title="Direct link to Distributions">​</a></h2>
<p>An optimal distribution that results in evenly distributed data is the most important factor in Apache Cloudberry. In an MPP shared nothing environment overall response time for a query is measured by the completion time for all segments. The system is only as fast as the slowest segment. If the data is skewed, segments with more data will take more time to complete, so every segment must have an approximately equal number of rows and perform approximately the same amount of processing. Poor performance and out of memory conditions may result if one segment has significantly more data to process than other segments.</p>
<p>Consider the following best practices when deciding on a distribution strategy:</p>
<ul>
<li>Explicitly define a column or random distribution for all tables. Do not use the default.</li>
<li>Ideally, use a single column that will distribute data across all segments evenly.</li>
<li>Do not distribute on columns that will be used in the <code>WHERE</code> clause of a query.</li>
<li>Do not distribute on dates or timestamps.</li>
<li>The distribution key column data should contain unique values or very high cardinality.</li>
<li>If a single column cannot achieve an even distribution, use a multi-column distribution key with a maximum of two columns. Additional column values do not typically yield a more even distribution and they require additional time in the hashing process.</li>
<li>If a two-column distribution key cannot achieve an even distribution of data, use a random distribution. Multi-column distribution keys in most cases require motion operations to join tables, so they offer no advantages over a random distribution.</li>
</ul>
<p>Apache Cloudberry random distribution is not round-robin, so there is no guarantee of an equal number of records on each segment. Random distributions typically fall within a target range of less than ten percent variation.</p>
<p>Optimal distributions are critical when joining large tables together. To perform a join, matching rows must be located together on the same segment. If data is not distributed on the same join column, the rows needed from one of the tables are dynamically redistributed to the other segments. In some cases a broadcast motion, in which each segment sends its individual rows to all other segments, is performed rather than a redistribution motion, where each segment rehashes the data and sends the rows to the appropriate segments according to the hash key.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="local-co-located-joins">Local (co-located) joins<a href="#local-co-located-joins" class="hash-link" aria-label="Direct link to Local (co-located) joins" title="Direct link to Local (co-located) joins">​</a></h3>
<p>Using a hash distribution that evenly distributes table rows across all segments and results in local joins can provide substantial performance gains. When joined rows are on the same segment, much of the processing can be accomplished within the segment instance. These are called <em>local</em> or <em>co-located</em> joins. Local joins minimize data movement; each segment operates independently of the other segments, without network traffic or communications between segments.</p>
<p>To achieve local joins for large tables commonly joined together, distribute the tables on the same column. Local joins require that both sides of a join be distributed on the same columns (and in the same order) <em>and</em> that all columns in the distribution clause are used when joining tables. The distribution columns must also be the same data type—although some values with different data types may appear to have the same representation, they are stored differently and hash to different values, so they are stored on different segments.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="data-skew">Data skew<a href="#data-skew" class="hash-link" aria-label="Direct link to Data skew" title="Direct link to Data skew">​</a></h3>
<p>Data skew is often the root cause of poor query performance and out of memory conditions. Skewed data affects scan (read) performance, but it also affects all other query execution operations, for instance, joins and group by operations.</p>
<p>It is very important to <em>validate</em> distributions to <em>ensure</em> that data is evenly distributed after the initial load. It is equally important to <em>continue</em> to validate distributions after incremental loads.</p>
<p>The following query shows the number of rows per segment as well as the variance from the minimum and maximum numbers of rows:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">SELECT</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;Example Table&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">AS</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;Table Name&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#e6db74">max</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">AS</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;Max Seg Rows&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">min</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">AS</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;Min Seg Rows&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token function" style="color:#e6db74">max</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token operator" style="color:#66d9ef">-</span><span class="token function" style="color:#e6db74">min</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token operator" style="color:#66d9ef">*</span><span class="token number" style="color:#ae81ff">100.0</span><span class="token operator" style="color:#66d9ef">/</span><span class="token function" style="color:#e6db74">max</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">AS</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;Percentage Difference Between Max &amp; Min&quot;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">FROM</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token keyword" style="color:#66d9ef">SELECT</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">count</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token operator" style="color:#66d9ef">*</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> c</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> gp_segment_id </span><span class="token keyword" style="color:#66d9ef">FROM</span><span class="token plain"> facts </span><span class="token keyword" style="color:#66d9ef">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">BY</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">2</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">AS</span><span class="token plain"> a</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <code>gp_toolkit</code> schema has two views that you can use to check for skew.</p>
<ul>
<li>The <code>gp_toolkit.gp_skew_coefficients</code> view shows data distribution skew by calculating the coefficient of variation (CV) for the data stored on each segment. The <code>skccoeff</code> column shows the coefficient of variation (CV), which is calculated as the standard deviation divided by the average. It takes into account both the average and variability around the average of a data series. The lower the value, the better. Higher values indicate greater data skew.</li>
<li>The <code>gp_toolkit.gp_skew_idle_fractions</code> view shows data distribution skew by calculating the percentage of the system that is idle during a table scan, which is an indicator of computational skew. The <code>siffraction</code> column shows the percentage of the system that is idle during a table scan. This is an indicator of uneven data distribution or query processing skew. For example, a value of 0.1 indicates 10% skew, a value of 0.5 indicates 50% skew, and so on. Tables that have more than10% skew should have their distribution policies evaluated.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="processing-skew">Processing skew<a href="#processing-skew" class="hash-link" aria-label="Direct link to Processing skew" title="Direct link to Processing skew">​</a></h3>
<p>Processing skew results when a disproportionate amount of data flows to, and is processed by, one or a few segments. It is often the culprit behind Apache Cloudberry performance and stability issues. It can happen with operations such join, sort, aggregation, and various OLAP operations. Processing skew happens in flight while a query is running and is not as easy to detect as data skew, which is caused by uneven data distribution due to the wrong choice of distribution keys. Data skew is present at the table level, so it can be easily detected and avoided by choosing optimal distribution keys.</p>
<p>If single segments are failing, that is, not all segments on a host, it may be a processing skew issue. Identifying processing skew is currently a manual process. First look for spill files. If there is skew, but not enough to cause spill, it will not become a performance issue. If you determine skew exists, then find the query responsible for the skew.</p>
<p>The remedy for processing skew in almost all cases is to rewrite the query. Creating temporary tables can eliminate skew. Temporary tables can be randomly distributed to force a two-stage aggregation.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="partitioning">Partitioning<a href="#partitioning" class="hash-link" aria-label="Direct link to Partitioning" title="Direct link to Partitioning">​</a></h2>
<p>A good partitioning strategy reduces the amount of data to be scanned by reading only the partitions needed to satisfy a query.</p>
<p>Each partition is a separate physical file or set of files (in the case of column-oriented tables) on <em>every</em> segment. Just as reading a complete row in a wide columnar table requires more time than reading the same row from a heap table, reading all partitions in a partitioned table requires more time than reading the same data from a non-partitioned table.</p>
<p>Following are partitioning best practices:</p>
<ul>
<li>
<p>Partition large tables only, do not partition small tables.</p>
</li>
<li>
<p>Use partitioning on large tables <em>only</em> when partition elimination (partition pruning) can be achieved based on query criteria and is accomplished by partitioning the table based on the query predicate. Whenever possible, use range partitioning instead of list partitioning.</p>
</li>
<li>
<p>The query planner can selectively scan partitioned tables only when the query contains a direct and simple restriction of the table using immutable operators, such as <code>=</code>, <code>&lt;</code> , <code>&lt;=</code>, <code>&gt;</code>, <code>&gt;=</code>, and <code>&lt;&gt;</code>.</p>
</li>
<li>
<p>Selective scanning recognizes <code>STABLE</code> and <code>IMMUTABLE</code> functions, but does not recognize <code>VOLATILE</code> functions within a query. For example, <code>WHERE</code> clauses such as</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">date</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">CURRENT_DATE</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>cause the query planner to selectively scan partitioned tables, but a <code>WHERE</code> clause such as</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">time</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> TIMEOFDAY</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>does not. It is important to validate that queries are selectively scanning partitioned tables (partitions are being eliminated) by examining the query <code>EXPLAIN</code> plan.</p>
</li>
<li>
<p>Do not use default partitions. The default partition is always scanned but, more importantly, in many environments they tend to overfill resulting in poor performance.</p>
</li>
<li>
<p><em>Never</em> partition and distribute tables on the same column.</p>
</li>
<li>
<p>Do not use multi-level partitioning. While sub-partitioning is supported, it is not recommended because typically sub-partitions contain little or no data. It is a myth that performance increases as the number of partitions or sub-partitions increases; the administrative overhead of maintaining many partitions and sub-partitions will outweigh any performance benefits. For performance, scalability and manageability, balance partition scan performance with the number of overall partitions.</p>
</li>
<li>
<p>Beware of using too many partitions with column-oriented storage.</p>
</li>
<li>
<p>Consider workload concurrency and the average number of partitions opened and scanned for all concurrent queries.</p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="number-of-partition-and-columnar-storage-files">Number of partition and columnar storage files<a href="#number-of-partition-and-columnar-storage-files" class="hash-link" aria-label="Direct link to Number of partition and columnar storage files" title="Direct link to Number of partition and columnar storage files">​</a></h3>
<p>The only hard limit for the number of files Apache Cloudberry supports is the operating system&#x27;s open file limit. It is important, however, to consider the total number of files in the cluster, the number of files on every segment, and the total number of files on a host. In an MPP shared nothing environment, every node operates independently of other nodes. Each node is constrained by its disk, CPU, and memory. CPU and I/O constraints are not common with Apache Cloudberry, but memory is often a limiting factor because the query execution model optimizes query performance in memory.</p>
<p>The optimal number of files per segment also varies based on the number of segments on the node, the size of the cluster, SQL access, concurrency, workload, and skew. There are generally six to eight segments per host, but large clusters should have fewer segments per host. When using partitioning and columnar storage it is important to balance the total number of files in the cluster, but it is <em>more</em> important to consider the number of files per segment and the total number of files on a node.</p>
<p>Example with 64GB Memory per Node</p>
<ul>
<li>Number of nodes: 16</li>
<li>Number of segments per node: 8</li>
<li>Average number of files per segment: 10,000</li>
</ul>
<p>The total number of files per node is <code>8*10,000 = 80,000</code> and the total number of files for the cluster is <code>8*16*10,000 = 1,280,000</code>. The number of files increases quickly as the number of partitions and the number of columns increase.</p>
<p>As a general best practice, limit the total number of files per node to under 100,000. As the previous example shows, the optimal number of files per segment and total number of files per node depends on the hardware configuration for the nodes (primarily memory), size of the cluster, SQL access, concurrency, workload and skew.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="indexes">Indexes<a href="#indexes" class="hash-link" aria-label="Direct link to Indexes" title="Direct link to Indexes">​</a></h2>
<p>Indexes are not generally needed in Apache Cloudberry. Most analytical queries operate on large volumes of data, while indexes are intended for locating single rows or small numbers of rows of data. In Apache Cloudberry, a sequential scan is an efficient method to read data as each segment contains an equal portion of the data and all segments work in parallel to read the data.</p>
<p>If adding an index does not produce performance gains, drop it. Verify that every index you create is used by the optimizer.</p>
<p>For queries with high selectivity, indexes may improve query performance. Create an index on a single column of a columnar table for drill through purposes for high cardinality columns that are required for highly selective queries.</p>
<p>Do not index columns that are frequently updated. Creating an index on a column that is frequently updated increases the number of writes required on updates.</p>
<p>Indexes on expressions should be used only if the expression is used frequently in queries.</p>
<p>An index with a predicate creates a partial index that can be used to select a small number of rows from large tables.</p>
<p>Avoid overlapping indexes. Indexes that have the same leading column are redundant.</p>
<p>Indexes can improve performance on compressed append-optimized tables for queries that return a targeted set of rows. For compressed data, an index access method means only the necessary pages are uncompressed.</p>
<p>Create selective B-tree indexes. Index selectivity is a ratio of the number of distinct values a column has divided by the number of rows in a table. For example, if a table has 1000 rows and a column has 800 distinct values, the selectivity of the index is 0.8, which is considered good.</p>
<p>As a general rule, drop indexes before loading data into a table. The load will run an order of magnitude faster than loading data into a table with indexes. After the load, re-create the indexes.</p>
<p>Bitmap indexes are suited for querying and not updating. Bitmap indexes perform best when the column has a low cardinality—100 to 100,000 distinct values. Do not use bitmap indexes for unique columns, very high, or very low cardinality data. Do not use bitmap indexes for transactional workloads.</p>
<p>If indexes are needed on partitioned tables, the index columns must be different than the partition columns. A benefit of indexing partitioned tables is that because the b-tree performance degrades exponentially as the size of the b-tree grows, creating indexes on partitioned tables creates smaller b-trees that perform better than with non-partitioned tables.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="column-sequence-and-byte-alignment">Column sequence and byte alignment<a href="#column-sequence-and-byte-alignment" class="hash-link" aria-label="Direct link to Column sequence and byte alignment" title="Direct link to Column sequence and byte alignment">​</a></h2>
<p>For optimum performance lay out the columns of a table to achieve data type byte alignment. Lay out the columns in heap tables in the following order:</p>
<ol>
<li>Distribution and partition columns</li>
<li>Fixed numeric types</li>
<li>Variable data types</li>
</ol>
<p>Lay out the data types from largest to smallest, so that <code>BIGINT</code> and <code>TIMESTAMP</code> come before <code>INT</code> and <code>DATE</code>, and all of these types come before <code>TEXT</code>, <code>VARCHAR</code>, or <code>NUMERIC(x,y)</code>. For example, 8-byte types first (<code>BIGINT</code>, <code>TIMESTAMP</code>), 4-byte types next (<code>INT</code>, <code>DATE</code>), 2-byte types next (<code>SMALLINT</code>), and variable data type last (<code>VARCHAR</code>).</p>
<p>Instead of defining columns in this sequence:</p>
<p><code>Int</code>, <code>Bigint</code>, <code>Timestamp</code>, <code>Bigint</code>, <code>Timestamp</code>, <code>Int</code> (distribution key), <code>Date</code> (partition key), <code>Bigint</code>, <code>Smallint</code></p>
<p>define the columns in this sequence:</p>
<p><code>Int</code> (distribution key), <code>Date</code> (partition key), <code>Bigint</code>, <code>Bigint</code>, <code>Timestamp</code>, <code>Bigint</code>, <code>Timestamp</code>, <code>Int</code>, <code>Smallint</code></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/apache/cloudberry-site/edit/main/versioned_docs/version-2.x/tutorials/best-practices/schema-design-best-practices.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_VsjB"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-09-01T02:33:53.000Z">Sep 1, 2025</time></b> by <b>Dianjin Wang</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/tutorials/best-practices/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label single-line-overflow hide-before-after">Best Practices Summary</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/tutorials/best-practices/load-data-best-practices"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label single-line-overflow hide-before-after">Load Data</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_jeP5 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#data-types" class="table-of-contents__link toc-highlight">Data types</a></li><li><a href="#storage-model" class="table-of-contents__link toc-highlight">Storage model</a></li><li><a href="#compression" class="table-of-contents__link toc-highlight">Compression</a></li><li><a href="#distributions" class="table-of-contents__link toc-highlight">Distributions</a></li><li><a href="#partitioning" class="table-of-contents__link toc-highlight">Partitioning</a></li><li><a href="#indexes" class="table-of-contents__link toc-highlight">Indexes</a></li><li><a href="#column-sequence-and-byte-alignment" class="table-of-contents__link toc-highlight">Column sequence and byte alignment</a></li></ul></div></div></div></div></main></div></div></div><div class="wrap_QlFE"><div class="mainWrap_IbWk"><div class="linksWrap_Zcc4"><div><div class="footerLinkTitle_PxTg">Support</div><div class="footerLinkItem_Kf4k"><a href="https://github.com/apache/cloudberry/issues" target="_blank" rel="noopener noreferrer">GitHub Issues</a></div><div class="footerLinkItem_Kf4k"><a href="https://github.com/apache/cloudberry/discussions" target="_blank" rel="noopener noreferrer">GitHub Discussions</a></div><div class="footerLinkItem_Kf4k"><a href="https://inviter.co/apache-cloudberry" target="_blank" rel="noopener noreferrer">Slack</a></div><div class="footerLinkItem_Kf4k"><a href="https://x.com/ASFCloudberry" target="_blank" rel="noopener noreferrer">Twitter</a></div><div class="footerLinkItem_Kf4k"><a href="https://youtube.com/@ApacheCloudberry" target="_blank" rel="noopener noreferrer">Youtube</a></div><div class="footerLinkItem_Kf4k"><a target="_self" href="/community/security">Security</a></div></div><div><div class="footerLinkTitle_PxTg">Resources</div><div class="footerLinkItem_Kf4k"><a href="/releases" target="_blank">Download</a></div><div class="footerLinkItem_Kf4k"><a target="_self" href="/docs/">Documentation</a></div><div class="footerLinkItem_Kf4k"><a target="_self" href="/community/events">Events</a></div><div class="footerLinkItem_Kf4k"><a href="/community/brand" target="_blank">Brand Guidelines</a></div></div><div><div class="footerLinkTitle_PxTg">Contribution</div><div class="footerLinkItem_Kf4k"><a target="_self" href="/contribute/git">Working with Git &amp; GitHub</a></div><div class="footerLinkItem_Kf4k"><a target="_self" href="/contribute/how-to-contribute">Contribution Overview</a></div><div class="footerLinkItem_Kf4k"><a target="_self" href="/contribute/code">Code Contribution</a></div><div class="footerLinkItem_Kf4k"><a target="_self" href="/contribute/doc">Doc Contribution</a></div></div></div><div class="logoLinkWrap_MDp5"><div class="logoWrap_qcVI"><img class="logo_cphB" src="/img/apache-incubator.svg" alt=""></div><div class="links_yA93"><svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" class="item_KKoc" cursor="pointer"><path d="M15.002 0c-8.288 0-15 6.713-15 15 0 6.637 4.293 12.244 10.256 14.231.75.131 1.031-.319 1.031-.712 0-.356-.019-1.538-.019-2.794-3.769.694-4.744-.919-5.044-1.763-.168-.43-.9-1.762-1.537-2.118-.525-.282-1.275-.975-.019-.994 1.181-.019 2.025 1.087 2.306 1.537 1.35 2.27 3.507 1.632 4.37 1.238.13-.975.524-1.631.956-2.006-3.338-.375-6.826-1.669-6.826-7.406 0-1.632.582-2.982 1.538-4.032-.15-.375-.675-1.912.15-3.975 0 0 1.256-.394 4.125 1.538 1.2-.338 2.475-.506 3.75-.506s2.55.168 3.75.506c2.869-1.95 4.125-1.538 4.125-1.538.825 2.063.3 3.6.15 3.975.956 1.05 1.538 2.382 1.538 4.032 0 5.756-3.507 7.03-6.844 7.406.544.468 1.012 1.369 1.012 2.775 0 2.006-.018 3.619-.018 4.125 0 .394.28.862 1.03.712A15.024 15.024 0 0 0 30.003 15c0-8.287-6.713-15-15-15Z"></path></svg><svg width="32" height="26" viewBox="0 0 32 26" fill="none" xmlns="http://www.w3.org/2000/svg" class="item_KKoc" cursor="pointer"><path d="M31.319 3.484c-1.145.507-2.36.84-3.603.987a6.293 6.293 0 0 0 2.758-3.47 12.518 12.518 0 0 1-3.983 1.52A6.274 6.274 0 0 0 15.64 6.815c0 .493.056.97.161 1.43a17.811 17.811 0 0 1-12.93-6.555 6.252 6.252 0 0 0-.85 3.154 6.272 6.272 0 0 0 2.791 5.222 6.253 6.253 0 0 1-2.841-.785l-.001.077a6.277 6.277 0 0 0 5.033 6.153 6.305 6.305 0 0 1-2.834.108 6.278 6.278 0 0 0 5.86 4.356 12.59 12.59 0 0 1-7.79 2.686c-.5 0-1-.03-1.497-.088a17.746 17.746 0 0 0 9.616 2.818c11.54 0 17.849-9.559 17.849-17.848 0-.272-.007-.544-.019-.812a12.746 12.746 0 0 0 3.13-3.246Z"></path></svg><svg width="30" height="24" viewBox="0 0 30 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="item_KKoc" cursor="pointer"><path d="M15.366 0c.801.004 2.805.024 4.935.11l.755.032c2.145.102 4.287.275 5.35.571 1.417.398 2.53 1.56 2.907 3.033.6 2.339.675 6.903.684 8.008l.002.229v.032l-.002.229c-.009 1.104-.084 5.669-.684 8.008-.381 1.478-1.495 2.64-2.907 3.032-1.063.297-3.205.47-5.35.571l-.755.033c-2.13.086-4.134.105-4.935.11h-.734c-1.696-.01-8.785-.087-11.04-.714-1.418-.398-2.532-1.56-2.908-3.032-.6-2.34-.675-6.904-.684-8.008v-.49c.01-1.105.084-5.67.684-8.008.382-1.478 1.496-2.64 2.908-3.033C5.847.086 12.936.01 14.632 0h.734Zm-3.367 6.749v10.5l9-5.25-9-5.25Z"></path></svg><svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" class="item_KKoc" cursor="pointer"><path d="M6.791 18.77a2.959 2.959 0 0 1-2.952 2.952 2.959 2.959 0 0 1-2.951-2.951 2.959 2.959 0 0 1 2.951-2.952h2.952v2.952Zm1.487 0a2.959 2.959 0 0 1 2.952-2.951 2.959 2.959 0 0 1 2.952 2.952v7.39a2.959 2.959 0 0 1-2.952 2.952 2.959 2.959 0 0 1-2.952-2.952v-7.39ZM11.23 6.792A2.959 2.959 0 0 1 8.278 3.84 2.959 2.959 0 0 1 11.23.888a2.959 2.959 0 0 1 2.952 2.951v2.952H11.23Zm0 1.487a2.959 2.959 0 0 1 2.952 2.952 2.959 2.959 0 0 1-2.952 2.952H3.84A2.959 2.959 0 0 1 .887 11.23a2.959 2.959 0 0 1 2.951-2.952h7.391Zm11.98 2.952a2.959 2.959 0 0 1 2.951-2.952 2.959 2.959 0 0 1 2.952 2.952 2.959 2.959 0 0 1-2.952 2.952H23.21V11.23Zm-1.488 0a2.959 2.959 0 0 1-2.951 2.952 2.959 2.959 0 0 1-2.952-2.952V3.84A2.959 2.959 0 0 1 18.771.887a2.959 2.959 0 0 1 2.951 2.951v7.391Zm-2.951 11.98a2.959 2.959 0 0 1 2.951 2.951 2.959 2.959 0 0 1-2.951 2.952 2.959 2.959 0 0 1-2.952-2.952V23.21h2.952Zm0-1.488a2.959 2.959 0 0 1-2.952-2.951 2.959 2.959 0 0 1 2.952-2.952h7.39a2.959 2.959 0 0 1 2.952 2.952 2.959 2.959 0 0 1-2.952 2.951h-7.39Z"></path></svg><svg width="28" height="30" viewBox="0 0 28 30" fill="none" xmlns="http://www.w3.org/2000/svg" class="item_KKoc" cursor="pointer"><path d="M22.48 4.286H5.195c-.845 0-1.52.724-1.52 1.568v18.579c0 .844.675 1.568 1.52 1.568h17.283c.845 0 1.52-.724 1.52-1.568V5.854c0-.844-.675-1.568-1.52-1.568Z"></path><path d="M6.233 12.156h3.081v10.756H6.233V12.156Zm1.57-5.315c.988 0 1.802.875 1.802 1.938s-.814 1.939-1.803 1.939C6.814 10.718 6 9.842 6 8.779c0-1.063.814-1.938 1.802-1.938Zm3.488 5.315h2.965v1.439h.058c.407-.876 1.453-1.751 2.965-1.751 3.14 0 3.721 2.25 3.721 5.127v5.879h-3.081v-5.253c0-1.25 0-2.877-1.628-2.877s-1.86 1.376-1.86 2.752v5.315h-3.082v-10.63h-.058Z" fill="#000"></path></svg><svg width="34" height="28" viewBox="0 0 34 28" fill="none" xmlns="http://www.w3.org/2000/svg" class="item_KKoc" cursor="pointer"><path d="M26.863 16.567c.748 0 1.347-.636 1.347-1.347 0-.748-.599-1.347-1.347-1.347s-1.347.599-1.347 1.347.599 1.347 1.347 1.347Zm-6.639 0c.749 0 1.347-.636 1.347-1.347 0-.748-.598-1.347-1.347-1.347-.748 0-1.346.599-1.346 1.347s.598 1.347 1.346 1.347Zm9.852 7.56a.52.52 0 0 0-.258.553c0 .074 0 .148.036.221.148.627.442 1.622.442 1.66 0 .11.037.184.037.257a.33.33 0 0 1-.331.332c-.074 0-.11-.037-.184-.074l-2.174-1.253c-.147-.074-.331-.147-.516-.147-.11 0-.22 0-.294.037-1.032.294-2.1.442-3.242.442-5.49 0-9.91-3.687-9.91-8.258 0-4.57 4.42-8.257 9.91-8.257 5.489 0 9.91 3.686 9.91 8.257 0 2.47-1.327 4.719-3.427 6.23ZM24.01 8.147a13.662 13.662 0 0 0-.418-.007c-6.262 0-11.41 4.29-11.41 9.757 0 .83.119 1.634.342 2.4h-.133c-1.33 0-2.659-.221-3.877-.553-.111-.037-.222-.037-.333-.037-.221 0-.443.074-.627.185L4.932 21.4a.525.525 0 0 1-.221.074.409.409 0 0 1-.406-.405c0-.11.036-.184.073-.294.037-.037.37-1.251.554-1.987 0-.074.037-.184.037-.258a.834.834 0 0 0-.332-.662C2.089 16.065.5 13.378.5 10.398.501 4.916 5.855.5 12.428.5 18.073.5 22.82 3.753 24.01 8.146Zm-7.73.627c.859 0 1.54-.716 1.54-1.54 0-.858-.681-1.539-1.54-1.539-.86 0-1.54.68-1.54 1.54 0 .859.68 1.54 1.54 1.54Zm-7.89 0c.86 0 1.54-.716 1.54-1.54 0-.858-.68-1.539-1.54-1.539-.859 0-1.539.68-1.539 1.54 0 .859.68 1.54 1.54 1.54Z"></path></svg></div></div></div><div class="copyrightWrap_yPz7"><div class="copyright_AoBa">
      <p>
        Apache Cloudberry is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.
      </p>
      <p>
        Copyright © 2025 The Apache Software Foundation, Licensed under the Apache License, Version 2.0.</p>
      <p>
        Apache®, the names of Apache projects, and the feather logo are either registered trademarks or trademarks of the Apache Software Foundation in the United States and/or other countries.
      </p>
      </div></div></div></div>
</body>
</html>